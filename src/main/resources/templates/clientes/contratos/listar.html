<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contratos de Clientes - Portal CEO</title>

  <link rel="stylesheet" th:href="@{/css/style.css}" />
  <link rel="stylesheet" th:href="@{/css/sidebar.css}" />
  <link rel="stylesheet" th:href="@{/css/notifications.css}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>

<body>
  <div class="app-container">
    <aside th:replace="~{components/sidebar :: sidebar}"></aside>

    <main class="main-content">
      <header th:replace="~{components/topbar :: topbar}"></header>

      <section class="content-area">
        <div class="header-section">
          <div>
            <p class="breadcrumb"><a href="/clientes">Clientes</a> / Contratos</p>
            <h1>Contratos de Clientes</h1>
          </div>
          <div class="actions">
            <a href="/contratos/novo" class="btn-primary">
              <i class="fas fa-plus"></i>
              Novo Contrato
            </a>
          </div>
        </div>

        <div class="metrics-grid">
          <article class="card metric-card">
            <span>Total Contratos</span>
            <strong th:text="${metricas.total}">0</strong>
          </article>
          <article class="card metric-card success">
            <span>Ativos</span>
            <strong th:text="${metricas.ativos}">0</strong>
          </article>
          <article class="card metric-card warning">
            <span>Vencem em 30 dias</span>
            <strong th:text="${metricas.vencendo}">0</strong>
          </article>
          <article class="card metric-card danger">
            <span>Expirados</span>
            <strong th:text="${metricas.expirados}">0</strong>
          </article>
          <article class="card metric-card">
            <span>Valor Ativo (R$)</span>
            <strong th:text="${metricas.valorAtivo != null ? #numbers.formatDecimal(metricas.valorAtivo, 2, 2) : '0,00'}">0,00</strong>
          </article>
        </div>

        <form class="card filter-form" method="get" action="/clientes/contratos/listar">
          <div class="form-group">
            <label for="busca">Pesquisar</label>
            <input type="text" id="busca" name="busca" placeholder="Cliente, contrato ou descrição"
              th:value="${filtros.busca}" />
          </div>
          <div class="form-group">
            <label for="clienteId">Cliente</label>
            <select id="clienteId" name="clienteId">
              <option th:value="" th:selected="${filtros.clienteId == null}">Todos</option>
              <option th:each="cliente : ${clientes}" th:value="${cliente.id}"
                th:text="${cliente.nomeFantasia != null && !cliente.nomeFantasia.isBlank() ? cliente.nomeFantasia : cliente.nome}"
                th:selected="${filtros.clienteId == cliente.id}"></option>
            </select>
          </div>
          <div class="form-group">
            <label for="status">Status</label>
            <select id="status" name="status">
              <option value="" th:selected="${filtros.status == null || filtros.status.isBlank()}">Todos</option>
              <option th:each="s : ${statusContrato}" th:value="${s.name()}" th:text="${s.name()}"
                th:selected="${filtros.status == s.name()}"></option>
            </select>
          </div>
          <div class="form-group">
            <label for="size">Itens por página</label>
            <select id="size" name="size">
              <option th:selected="${contratosPage.size == 10}">10</option>
              <option th:selected="${contratosPage.size == 20}">20</option>
              <option th:selected="${contratosPage.size == 50}">50</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-secondary">
              <i class="fas fa-filter"></i> Aplicar
            </button>
            <a href="/clientes/contratos/listar" class="btn-link">Limpar</a>
          </div>
        </form>

        <article class="card">
          <div class="table-responsive">
            <table class="table-list">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Nº Contrato</th>
                  <th>Cliente</th>
                  <th>Início</th>
                  <th>Fim</th>
                  <th>Status</th>
                  <th>Valor</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="contrato : ${contratos}">
                  <td th:text="${contrato.id}">1</td>
                  <td th:text="${contrato.numeroContrato != null ? contrato.numeroContrato : '--'}">0001</td>
                  <td
                    th:text="${contrato.cliente != null ? (contrato.cliente.nomeFantasia != null && !contrato.cliente.nomeFantasia.isBlank() ? contrato.cliente.nomeFantasia : contrato.cliente.nome) : '—'}">
                    Cliente</td>
                  <td th:text="${contrato.dataInicio != null ? #temporals.format(contrato.dataInicio, 'dd/MM/yyyy') : '-'}">
                    01/01/2025</td>
                  <td th:text="${contrato.dataFim != null ? #temporals.format(contrato.dataFim, 'dd/MM/yyyy') : '-'}">
                    01/12/2025</td>
                  <td>
                    <span class="status-chip"
                      th:text="${contrato.status != null ? contrato.status.name() : 'N/A'}"
                      th:classappend="${contrato.status == T(com.jaasielsilva.portalceo.model.StatusContrato).ATIVO ? ' success' :
                                      contrato.status == T(com.jaasielsilva.portalceo.model.StatusContrato).EXPIRADO ? ' danger' :
                                      contrato.status == T(com.jaasielsilva.portalceo.model.StatusContrato).EM_RENEGOCIACAO ? ' warning' :
                                      contrato.status == T(com.jaasielsilva.portalceo.model.StatusContrato).CANCELADO ? ' muted' : ''}">
                      ATIVO</span>
                  </td>
                  <td th:text="${contrato.valor != null ? 'R$ ' + #numbers.formatDecimal(contrato.valor, 2, 2) : '—'}">
                    R$ 0,00</td>
                  <td class="table-actions">
                    <a th:href="@{'/clientes/contratos/' + ${contrato.id} + '/detalhes'}" class="btn btn-info btn-sm">
                      <i class="fas fa-eye"></i> Detalhes
                    </a>
                  </td>
                </tr>
                <tr th:if="${#lists.isEmpty(contratos)}">
                  <td colspan="8" class="text-center">Nenhum contrato encontrado para os filtros informados.</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="pagination" th:if="${contratosPage.totalPages > 1}">
            <a th:if="${contratosPage.hasPrevious()}"
              th:href="@{/clientes/contratos/listar(page=${contratosPage.number - 1}, size=${contratosPage.size}, busca=${filtros.busca}, status=${filtros.status}, clienteId=${filtros.clienteId})}">
              &laquo; Anterior
            </a>
            <span>Página <strong th:text="${contratosPage.number + 1}">1</strong> de
              <strong th:text="${contratosPage.totalPages}">1</strong></span>
            <a th:if="${contratosPage.hasNext()}"
              th:href="@{/clientes/contratos/listar(page=${contratosPage.number + 1}, size=${contratosPage.size}, busca=${filtros.busca}, status=${filtros.status}, clienteId=${filtros.clienteId})}">
              Próxima &raquo;
            </a>
          </div>
        </article>
      </section>

      <footer th:replace="~{components/footer :: footer}"></footer>
    </main>
  </div>

  <script th:src="@{/js/script.js}"></script>
  <script th:src="@{/js/notifications.js}"></script>
  <script src="/js/sidebar.js" defer></script>
</body>

</html>

