<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"> <!-- define UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- responsivo -->
    <title>Topbar - ERP Corporativo</title>
    <link rel="stylesheet" href="/css/fontawesome.min.css"/>
</head>
<body>
    <header class="topbar" th:fragment="topbar" th:inline="text">
        <div class="topbar-title">
            <h1>Sistema ERP Corporativo</h1>
        </div>
        <div class="topbar-actions">
            <!-- Notificações -->
            <a href="#" class="notification-trigger topbar-btn" title="Notificações">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" style="display: none;">0</span>
            </a>

            <!-- Usuário -->
            <a th:if="${usuarioLogado != null}"
               th:href="@{/usuarios/{id}/editar(id=${usuarioLogado.id})}"
               class="user-initial" title="Meu Perfil"
               th:text="${usuarioLogado.nome.substring(0,1).toUpperCase()}">U</a>
            <a th:if="${usuarioLogado == null}"
               href="/usuarios"
               class="user-initial" title="Usuário">
               U
            </a>
            <span class="user-name" th:text="${usuarioLogado != null ? usuarioLogado.nome : 'Usuário'}">Usuário</span>
        </div>

        <!-- Email do usuário para WebSocket global (injeta via Thymeleaf corretamente) -->
        <div data-user-email="[[${#httpServletRequest.remoteUser != null ? #httpServletRequest.remoteUser : ''}]]" style="display:none;"></div>

        <!-- jQuery fallback (para toasts) -->
        <script>
            if (typeof window.jQuery === 'undefined') {
                var jq = document.createElement('script');
                jq.src = 'https://code.jquery.com/jquery-3.7.0.min.js';
                document.head.appendChild(jq);
            }
        </script>

        <!-- Cliente WebSocket global para toasts -->
        <script src="/js/websocket-notifications.js"></script>
    </header>
</body>
</html>
