<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title th:text="${fornecedor.id == null ? 'Novo Fornecedor' : 'Editar Fornecedor'} + ' - Painel do CEO'">Painel do CEO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 e FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Estilos Globais -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link href="/css/notifications.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="bg-light">
    <div class="app-container">
        <aside th:replace="~{components/sidebar :: sidebar}"></aside>

        <main class="main-content">
            <header th:replace="~{components/topbar :: topbar}"></header>

            <div class="container-fluid p-4">
                
                <!-- Breadcrumb -->
                <nav aria-label="breadcrumb" class="mb-4">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/dashboard}" class="text-decoration-none">Home</a></li>
                        <li class="breadcrumb-item"><a th:href="@{/fornecedores}" class="text-decoration-none">Fornecedores</a></li>
                        <li class="breadcrumb-item active" aria-current="page" th:text="${fornecedor.id == null ? 'Novo Cadastro' : 'Editar Fornecedor'}"></li>
                    </ol>
                </nav>

                <!-- Feedback Messages -->
                <script th:inline="javascript">
                    (function () {
                        var msgSucesso = /*[[${msgSucesso}]]*/ null;
                        var msgErro = /*[[${msgErro}]]*/ null;
                        var erroParam = /*[[${param.erro != null ? param.erro[0] : null}]]*/ null;

                        function show(icon, title, text) {
                            if (!text) return;
                            if (typeof Swal !== 'undefined') {
                                Swal.fire({ icon: icon, title: title, text: text, confirmButtonText: 'OK' });
                            }
                        }

                        if (msgSucesso) show('success', 'Sucesso', msgSucesso);
                        else if (msgErro) show('error', 'Erro', msgErro);
                        else if (erroParam) show('error', 'Erro', erroParam);
                    })();
                </script>

                <div class="card shadow-sm border-0">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0 text-primary fw-bold">
                            <i class="fas" th:classappend="${fornecedor.id == null ? 'fa-plus-circle' : 'fa-edit'}"></i>
                            <span th:text="${fornecedor.id == null ? 'Cadastrar Novo Fornecedor' : 'Editar Fornecedor'}"></span>
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <form th:action="@{/fornecedores/salvar}" method="post" th:object="${fornecedor}" id="formFornecedor" class="needs-validation" novalidate>
                            <input type="hidden" th:field="*{id}" />

                            <h6 class="text-muted text-uppercase small fw-bold mb-3"><i class="fas fa-building me-1"></i> Dados da Empresa</h6>
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Razão Social <span class="text-danger">*</span></label>
                                    <input type="text" th:field="*{razaoSocial}" class="form-control" required maxlength="100" placeholder="Razão Social da empresa">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Nome Fantasia</label>
                                    <input type="text" th:field="*{nomeFantasia}" class="form-control" maxlength="100" placeholder="Nome comercial">
                                </div>
                                
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">CNPJ <span class="text-danger">*</span></label>
                                    <input type="text" th:field="*{cnpj}" id="cnpj" class="form-control" required maxlength="18" placeholder="00.000.000/0000-00">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Inscrição Estadual</label>
                                    <input type="text" th:field="*{inscricaoEstadual}" class="form-control" maxlength="20" placeholder="IE">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Status <span class="text-danger">*</span></label>
                                    <select th:field="*{status}" class="form-select" required>
                                        <option value="ATIVO">ATIVO</option>
                                        <option value="INATIVO">INATIVO</option>
                                    </select>
                                </div>
                            </div>

                            <hr class="text-muted opacity-25">

                            <h6 class="text-muted text-uppercase small fw-bold mb-3 mt-4"><i class="fas fa-address-book me-1"></i> Contato</h6>
                            <div class="row g-3 mb-4">
                                <div class="col-md-3">
                                    <label class="form-label fw-semibold">Telefone Fixo</label>
                                    <input type="text" th:field="*{telefone}" id="telefone" class="form-control" maxlength="14" placeholder="(00) 0000-0000">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label fw-semibold">Celular / WhatsApp</label>
                                    <input type="text" th:field="*{celular}" id="celular" class="form-control" maxlength="15" placeholder="(00) 00000-0000">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Email Comercial</label>
                                    <input type="email" th:field="*{email}" class="form-control" maxlength="100" placeholder="email@empresa.com">
                                </div>
                                <div class="col-md-12">
                                    <label class="form-label fw-semibold">Website</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fas fa-globe"></i></span>
                                        <input type="url" th:field="*{site}" class="form-control" maxlength="100" placeholder="https://www.empresa.com.br">
                                    </div>
                                </div>
                            </div>

                            <hr class="text-muted opacity-25">

                            <h6 class="text-muted text-uppercase small fw-bold mb-3 mt-4"><i class="fas fa-map-marker-alt me-1"></i> Endereço</h6>
                            <div class="row g-3 mb-4">
                                <div class="col-md-2">
                                    <label class="form-label fw-semibold">CEP</label>
                                    <input type="text" th:field="*{cep}" id="cep" class="form-control" maxlength="9" placeholder="00000-000">
                                </div>
                                <div class="col-md-8">
                                    <label class="form-label fw-semibold">Rua</label>
                                    <input type="text" th:field="*{rua}" id="rua" class="form-control" maxlength="100" placeholder="Nome da rua">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label fw-semibold">Número</label>
                                    <input type="text" th:field="*{numero}" class="form-control" maxlength="10">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Bairro</label>
                                    <input type="text" th:field="*{bairro}" id="bairro" class="form-control" maxlength="50">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Cidade</label>
                                    <input type="text" th:field="*{cidade}" id="cidade" class="form-control" maxlength="50">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label fw-semibold">UF</label>
                                    <input type="text" th:field="*{estado}" id="estado" class="form-control" maxlength="2" placeholder="UF">
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-semibold">Observações</label>
                                <textarea th:field="*{observacoes}" class="form-control" rows="3" maxlength="300" placeholder="Informações adicionais..."></textarea>
                            </div>

                            <div class="d-flex justify-content-end gap-2 pt-3 border-top">
                                <a th:href="@{/fornecedores}" class="btn btn-light border"><i class="fas fa-arrow-left me-1"></i> Cancelar</a>
                                <button type="submit" class="btn btn-primary px-4"><i class="fas fa-save me-1"></i> Salvar Dados</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <footer th:replace="~{components/footer :: footer}"></footer>
        </main>
    </div>

    <!-- Scripts -->
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="/js/sidebar.js" defer></script>
    <script th:src="@{/js/notifications.js}"></script>
    
    <script>
        $(document).ready(function(){
            $('#cnpj').mask('00.000.000/0000-00');
            $('#telefone').mask('(00) 0000-0000');
            $('#celular').mask('(00) 00000-0000');
            $('#cep').mask('00000-000');
            
            // Busca CEP
            $('#cep').blur(function() {
                var cep = $(this).val().replace(/\D/g, '');
                if (cep != "") {
                    var validacep = /^[0-9]{8}$/;
                    if(validacep.test(cep)) {
                        $("#rua").val("...");
                        $("#bairro").val("...");
                        $("#cidade").val("...");
                        $("#estado").val("...");
                        
                        $.getJSON("https://viacep.com.br/ws/"+ cep +"/json/?callback=?", function(dados) {
                            if (!("erro" in dados)) {
                                $("#rua").val(dados.logradouro);
                                $("#bairro").val(dados.bairro);
                                $("#cidade").val(dados.localidade);
                                $("#estado").val(dados.uf);
                            } else {
                                Swal.fire('Erro', 'CEP não encontrado.', 'error');
                            }
                        });
                    }
                }
            });
        });
    </script>
</body>
</html>