<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title th:text="${pageTitle} ?: 'Jurídico > Previdenciário (INSS)'">Jurídico > Previdenciário (INSS)</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/sidebar.css}" />
    <link rel="stylesheet" th:href="@{/css/notifications.css}" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
</head>

<body>
    <div class="app-container">
        <aside th:replace="~{components/sidebar :: sidebar}"></aside>
        <main class="main-content">
            <header th:replace="~{components/topbar :: topbar}"></header>

            <section class="content-area container-fluid py-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h1 class="h4 mb-1"><i class="fas fa-scale-balanced me-2"></i>Previdenciário (INSS)</h1>
                        <p class="text-muted mb-0">Processos e andamento por etapa</p>
                    </div>
                    <a class="btn btn-primary" href="/juridico/previdenciario/novo">
                        <i class="fas fa-plus me-2"></i>Novo processo
                    </a>
                </div>

                <div th:if="${sucesso}" class="alert alert-success" th:text="${sucesso}"></div>
                <div th:if="${erro}" class="alert alert-danger" th:text="${erro}"></div>

                <div class="card">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 90px;">#</th>
                                        <th>Cliente</th>
                                        <th>Etapa</th>
                                        <th>Status</th>
                                        <th>Responsável</th>
                                        <th style="width: 180px;">Abertura</th>
                                        <th style="width: 140px;">Decisão</th>
                                        <th style="width: 140px;">Valor da causa</th>
                                        <th style="width: 120px;"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:if="${processos == null || processos.isEmpty()}">
                                        <td colspan="7" class="text-center text-muted py-4">Nenhum processo cadastrado
                                        </td>
                                    </tr>
                                    <tr th:each="p : ${processos}">
                                        <td th:text="${p.id}">1</td>
                                        <td th:text="${p.cliente != null ? p.cliente.nome : '—'}">Cliente</td>
                                        <td>
                                            <span class="badge bg-secondary" th:text="${p.etapaAtual}">CADASTRO</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-info" th:text="${p.statusAtual}">ABERTO</span>
                                        </td>
                                        <td th:text="${p.responsavel != null ? p.responsavel.nome : '—'}">Responsável
                                        </td>
                                        <td
                                            th:text="${p.dataAbertura != null ? T(java.time.format.DateTimeFormatter).ofPattern('dd/MM/yyyy HH:mm').format(p.dataAbertura) : '—'}">
                                            —</td>
                                        <td>
                                            <span class="badge bg-secondary" th:text="${p.resultadoDecisao != null ? p.resultadoDecisao : '—'}">—</span>
                                        </td>
                                        <td th:text="${p.valorCausa != null ? 'R$ ' + #numbers.formatDecimal(p.valorCausa, 1, 'POINT', 2, 'COMMA') : '—'}">—</td>
                                        <td class="text-end">
                                            <a class="btn btn-sm btn-outline-primary"
                                                th:href="@{'/juridico/previdenciario/' + ${p.id}}">
                                                <i class="fas fa-eye me-1"></i>Detalhes
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <footer th:replace="~{components/footer :: footer}"></footer>
        </main>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script th:src="@{/js/sidebar.js}"></script>
    <script th:src="@{/js/notifications.js}"></script>
    <script th:inline="javascript">
        const sucessoMsg = /*[[${sucesso}]]*/ null;
        const erroMsg = /*[[${erro}]]*/ null;
        if (typeof Swal !== 'undefined') {
            if (sucessoMsg) {
                Swal.fire({ icon: 'success', title: 'Sucesso', text: sucessoMsg });
            }
            if (erroMsg) {
                Swal.fire({ icon: 'error', title: 'Erro', text: erroMsg });
            }
        }
    </script>
</body>

</html>
