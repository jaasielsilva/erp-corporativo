<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Auditoria RH - Início</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/sidebar.css" rel="stylesheet">
    <link href="/css/notifications.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-container">
        <aside th:replace="~{components/sidebar :: sidebar}"></aside>
        <main class="main-content">
            <header th:replace="~{components/topbar :: topbar}"></header>
            <section class="content-area">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12 text-center py-5">
                            <h1 class="display-6 text-muted">Auditoria RH</h1>
                            <p class="text-muted">Logs de atividades e revisões periódicas.</p>
                        </div>
                    </div>
                    <div class="row g-4">
                        <div class="col-12 col-md-6 col-xl-3">
                            <a href="/rh/auditoria/acessos" class="text-decoration-none">
                                <div class="card shadow-sm h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-user-check fa-2x text-primary"></i>
                                        <h5 class="mt-3">Log de Acessos</h5>
                                        <p class="text-muted">Autenticações e autorizações</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-12 col-md-6 col-xl-3">
                            <a href="/rh/auditoria/alteracoes" class="text-decoration-none">
                                <div class="card shadow-sm h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-edit fa-2x text-warning"></i>
                                        <h5 class="mt-3">Alterações de Dados</h5>
                                        <p class="text-muted">Edições realizadas no RH</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-12 col-md-6 col-xl-3">
                            <a href="/rh/auditoria/exportacoes" class="text-decoration-none">
                                <div class="card shadow-sm h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-file-export fa-2x text-success"></i>
                                        <h5 class="mt-3">Exportações</h5>
                                        <p class="text-muted">Relatórios e arquivos gerados</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-12 col-md-6 col-xl-3">
                            <a href="/rh/auditoria/revisoes" class="text-decoration-none">
                                <div class="card shadow-sm h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-search fa-2x text-danger"></i>
                                        <h5 class="mt-3">Revisões Periódicas</h5>
                                        <p class="text-muted">Revisões e conformidade</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-12 col-xl-8 mx-auto">
                            <div class="alert alert-secondary d-flex align-items-center" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                <div>
                                    Use os filtros nas páginas para refinar por período, usuário e recurso. Primeiro aplique apenas o período e, se necessário, adicione usuário e recurso.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-12 col-xl-8 mx-auto">
                            <div class="card shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0">Tendência de Acessos (24h)</h6>
                                        <div class="text-muted small">Atualiza a cada 60s</div>
                                    </div>
                                    <canvas id="chartAcessos24h" height="110"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <footer th:replace="~{components/footer :: footer}"></footer>
        </main>
    </div>
    <script src="/js/sidebar.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script th:src="@{/js/notifications.js}"></script>
    <script>
        let __acessosTimer;
        function carregarAcessos24h(){
            fetch('/api/rh/auditoria/metrics/acessos-24h')
                .then(r => r.json())
                .then(data => {
                    const ctx = document.getElementById('chartAcessos24h').getContext('2d');
                    if(window.__acessosChart){ window.__acessosChart.data.labels = data.labels; window.__acessosChart.data.datasets[0].data = data.series; window.__acessosChart.update(); return; }
                    window.__acessosChart = new Chart(ctx, {
                        type: 'line',
                        data: { labels: data.labels, datasets: [{ label: 'Acessos', data: data.series, borderColor: '#0d6efd', backgroundColor: 'rgba(13,110,253,0.2)', tension: 0.25, fill: true }] },
                        options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { beginAtZero: true } } }
                    });
                })
                .catch(()=>{});
        }
        document.addEventListener('DOMContentLoaded', () => { carregarAcessos24h(); __acessosTimer = setInterval(carregarAcessos24h, 60000); });
    </script>
</body>
</html>
