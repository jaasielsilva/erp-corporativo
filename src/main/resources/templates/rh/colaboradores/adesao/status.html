<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status do Processo - Portal CEO</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .status-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .status-card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            overflow: hidden;
        }
        
        .status-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .status-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .progress-section {
            padding: 30px;
            background: #f8f9fa;
        }
        
        .progress-custom {
            height: 12px;
            border-radius: 6px;
            background: #e9ecef;
        }
        
        .progress-bar-custom {
            border-radius: 6px;
            transition: width 0.6s ease;
        }
        
        .etapa-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .etapa-item:last-child {
            border-bottom: none;
        }
        
        .etapa-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.2rem;
        }
        
        .etapa-concluida {
            background: #28a745;
            color: white;
        }
        
        .etapa-atual {
            background: #007bff;
            color: white;
            animation: pulse 2s infinite;
        }
        
        .etapa-pendente {
            background: #e9ecef;
            color: #6c757d;
        }
        
        .info-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .alert-custom {
            border-left: 4px solid;
            border-radius: 0 8px 8px 0;
            padding: 20px;
        }
        
        .alert-info-custom {
            border-left-color: #17a2b8;
            background-color: #d1ecf1;
        }
        
        .alert-warning-custom {
            border-left-color: #ffc107;
            background-color: #fff3cd;
        }
        
        .alert-success-custom {
            border-left-color: #28a745;
            background-color: #d4edda;
        }
        
        .alert-danger-custom {
            border-left-color: #dc3545;
            background-color: #f8d7da;
        }
        
        .btn-refresh {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #dee2e6;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -23px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #007bff;
            border: 2px solid #fff;
            box-shadow: 0 0 0 2px #dee2e6;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div th:replace="~{fragments/header :: header}"></div>
    
    <div class="container mt-4">
        <div class="status-container">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="/rh">RH</a></li>
                    <li class="breadcrumb-item"><a href="/rh/colaboradores/adesao">Adesão de Colaborador</a></li>
                    <li class="breadcrumb-item active">Status do Processo</li>
                </ol>
            </nav>
            
            <!-- Card Principal de Status -->
            <div class="card status-card mb-4">
                <div class="status-header">
                    <div class="status-icon" id="status-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h2 id="status-titulo">Processo em Andamento</h2>
                    <p class="mb-0" id="status-descricao">Seu processo de adesão foi enviado e está sendo analisado</p>
                </div>
                
                <div class="progress-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Progresso do Processo</h5>
                        <span class="badge bg-primary" id="progresso-badge">0%</span>
                    </div>
                    
                    <div class="progress progress-custom mb-3">
                        <div class="progress-bar progress-bar-custom bg-primary" id="barra-progresso" role="progressbar" style="width: 0%"></div>
                    </div>
                    
                    <div class="row text-center">
                        <div class="col">
                            <small class="text-muted">Iniciado</small>
                        </div>
                        <div class="col">
                            <small class="text-muted">Em Análise</small>
                        </div>
                        <div class="col">
                            <small class="text-muted">Aprovação</small>
                        </div>
                        <div class="col">
                            <small class="text-muted">Finalizado</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Informações do Processo -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="info-card">
                        <h6><i class="fas fa-user me-2"></i>Dados do Colaborador</h6>
                        <p class="mb-1"><strong>Nome:</strong> <span th:text="${dadosAdesao.nome}">Nome do Colaborador</span></p>
                        <p class="mb-1"><strong>Email:</strong> <span th:text="${dadosAdesao.email}">email@exemplo.com</span></p>
                        <p class="mb-0"><strong>CPF:</strong> <span th:text="${dadosAdesao.cpf}">000.000.000-00</span></p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-card">
                        <h6><i class="fas fa-info-circle me-2"></i>Informações do Processo</h6>
                        <p class="mb-1"><strong>ID da Sessão:</strong> <code th:text="${sessionId}">session-id</code></p>
                        <p class="mb-1"><strong>Data de Envio:</strong> <span id="data-envio">-</span></p>
                        <p class="mb-0"><strong>Última Atualização:</strong> <span id="ultima-atualizacao">-</span></p>
                    </div>
                </div>
            </div>
            
            <!-- Etapas do Processo -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-list-ol me-2"></i>Etapas do Processo</h5>
                </div>
                <div class="card-body">
                    <div id="lista-etapas">
                        <div class="etapa-item">
                            <div class="etapa-icon etapa-concluida">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Dados Pessoais</h6>
                                <small class="text-muted">Informações pessoais coletadas</small>
                            </div>
                        </div>
                        
                        <div class="etapa-item">
                            <div class="etapa-icon etapa-concluida">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Documentos</h6>
                                <small class="text-muted">Documentos enviados e validados</small>
                            </div>
                        </div>
                        
                        <div class="etapa-item">
                            <div class="etapa-icon etapa-concluida">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Benefícios</h6>
                                <small class="text-muted">Benefícios selecionados</small>
                            </div>
                        </div>
                        
                        <div class="etapa-item">
                            <div class="etapa-icon etapa-atual">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Aprovação</h6>
                                <small class="text-muted">Aguardando aprovação do RH</small>
                            </div>
                        </div>
                        
                        <div class="etapa-item">
                            <div class="etapa-icon etapa-pendente">
                                <i class="fas fa-flag-checkered"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Finalização</h6>
                                <small class="text-muted">Processo finalizado</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mensagem de Status -->
            <div class="alert alert-info-custom alert-custom" id="mensagem-status">
                <div class="d-flex align-items-center">
                    <i class="fas fa-info-circle fa-2x me-3"></i>
                    <div>
                        <h6 class="mb-1">Processo Enviado para Aprovação</h6>
                        <p class="mb-0">Seu processo foi enviado para análise do departamento de RH. Você receberá uma notificação quando houver atualizações.</p>
                    </div>
                </div>
            </div>
            
            <!-- Histórico (se disponível) -->
            <div class="card mb-4" id="secao-historico" style="display: none;">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-history me-2"></i>Histórico do Processo</h5>
                </div>
                <div class="card-body">
                    <div class="timeline" id="timeline-historico">
                        <!-- Histórico será carregado via JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Ações Disponíveis -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Ações Disponíveis</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex gap-2 flex-wrap">
                        <button class="btn btn-outline-primary" onclick="atualizarStatus()">
                            <span class="loading-spinner d-none" id="spinner-atualizar"></span>
                            <i class="fas fa-sync-alt me-1" id="icon-atualizar"></i>
                            Atualizar Status
                        </button>
                        
                        <button class="btn btn-outline-info" onclick="imprimirComprovante()">
                            <i class="fas fa-print me-1"></i>
                            Imprimir Comprovante
                        </button>
                        
                        <button class="btn btn-outline-secondary" onclick="voltarInicio()">
                            <i class="fas fa-home me-1"></i>
                            Voltar ao Início
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Informações de Contato -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-phone me-2"></i>Precisa de Ajuda?</h5>
                </div>
                <div class="card-body">
                    <p class="mb-3">Se você tiver dúvidas sobre seu processo de adesão, entre em contato conosco:</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-envelope text-primary me-2"></i>
                                <span>rh@empresa.com</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-phone text-primary me-2"></i>
                                <span>(11) 1234-5678</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>
                            Horário de atendimento: Segunda a Sexta, das 8h às 18h
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Botão de Atualização Flutuante -->
    <button class="btn btn-primary btn-refresh" onclick="atualizarStatus()" title="Atualizar Status">
        <i class="fas fa-sync-alt"></i>
    </button>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <script th:inline="javascript">
        const sessionId = /*[[${sessionId}]]*/ 'default-session';
        let statusAtual = 'AGUARDANDO_APROVACAO';
        
        $(document).ready(function() {
            atualizarStatus();
            
            // Atualizar automaticamente a cada 30 segundos
            setInterval(atualizarStatus, 30000);
        });
        
        function atualizarStatus() {
            mostrarCarregamento(true);
            
            fetch(`/rh/colaboradores/adesao/api/status/${sessionId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        statusAtual = data.status;
                        atualizarInterface(data);
                    } else {
                        console.error('Erro ao obter status:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Erro ao atualizar status:', error);
                })
                .finally(() => {
                    mostrarCarregamento(false);
                });
        }
        
        function atualizarInterface(dados) {
            // Atualizar ícone e título principal
            const statusIcon = document.getElementById('status-icon');
            const statusTitulo = document.getElementById('status-titulo');
            const statusDescricao = document.getElementById('status-descricao');
            const mensagemStatus = document.getElementById('mensagem-status');
            
            switch (dados.status) {
                case 'AGUARDANDO_APROVACAO':
                    statusIcon.innerHTML = '<i class="fas fa-clock"></i>';
                    statusTitulo.textContent = 'Aguardando Aprovação';
                    statusDescricao.textContent = 'Seu processo está sendo analisado pelo departamento de RH';
                    mensagemStatus.className = 'alert alert-warning-custom alert-custom';
                    mensagemStatus.innerHTML = `
                        <div class="d-flex align-items-center">
                            <i class="fas fa-clock fa-2x me-3"></i>
                            <div>
                                <h6 class="mb-1">Processo em Análise</h6>
                                <p class="mb-0">Seu processo foi enviado para análise. Aguarde a aprovação do RH.</p>
                            </div>
                        </div>
                    `;
                    atualizarProgresso(75);
                    break;
                    
                case 'APROVADO':
                    statusIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
                    statusTitulo.textContent = 'Processo Aprovado!';
                    statusDescricao.textContent = 'Parabéns! Seu processo de adesão foi aprovado';
                    mensagemStatus.className = 'alert alert-success-custom alert-custom';
                    mensagemStatus.innerHTML = `
                        <div class="d-flex align-items-center">
                            <i class="fas fa-check-circle fa-2x me-3"></i>
                            <div>
                                <h6 class="mb-1">Processo Aprovado!</h6>
                                <p class="mb-0">Seu processo foi aprovado. Em breve você receberá as próximas instruções.</p>
                            </div>
                        </div>
                    `;
                    atualizarProgresso(100);
                    break;
                    
                case 'REJEITADO':
                    statusIcon.innerHTML = '<i class="fas fa-times-circle"></i>';
                    statusTitulo.textContent = 'Processo Rejeitado';
                    statusDescricao.textContent = 'Infelizmente seu processo não foi aprovado';
                    mensagemStatus.className = 'alert alert-danger-custom alert-custom';
                    mensagemStatus.innerHTML = `
                        <div class="d-flex align-items-center">
                            <i class="fas fa-times-circle fa-2x me-3"></i>
                            <div>
                                <h6 class="mb-1">Processo Rejeitado</h6>
                                <p class="mb-0">Seu processo não foi aprovado. Entre em contato com o RH para mais informações.</p>
                            </div>
                        </div>
                    `;
                    atualizarProgresso(50);
                    break;
                    
                default:
                    statusIcon.innerHTML = '<i class="fas fa-question-circle"></i>';
                    statusTitulo.textContent = 'Status Desconhecido';
                    statusDescricao.textContent = 'Não foi possível determinar o status atual';
                    mensagemStatus.className = 'alert alert-info-custom alert-custom';
                    atualizarProgresso(25);
            }
            
            // Atualizar datas
            const agora = new Date();
            document.getElementById('data-envio').textContent = agora.toLocaleDateString('pt-BR');
            document.getElementById('ultima-atualizacao').textContent = agora.toLocaleString('pt-BR');
        }
        
        function atualizarProgresso(porcentagem) {
            const barraProgresso = document.getElementById('barra-progresso');
            const progressoBadge = document.getElementById('progresso-badge');
            
            barraProgresso.style.width = porcentagem + '%';
            progressoBadge.textContent = porcentagem + '%';
            
            // Atualizar cor da barra baseada no progresso
            barraProgresso.className = 'progress-bar progress-bar-custom';
            if (porcentagem >= 100) {
                barraProgresso.classList.add('bg-success');
            } else if (porcentagem >= 75) {
                barraProgresso.classList.add('bg-warning');
            } else {
                barraProgresso.classList.add('bg-primary');
            }
        }
        
        function mostrarCarregamento(mostrar) {
            const spinner = document.getElementById('spinner-atualizar');
            const icon = document.getElementById('icon-atualizar');
            
            if (mostrar) {
                spinner.classList.remove('d-none');
                icon.classList.add('d-none');
            } else {
                spinner.classList.add('d-none');
                icon.classList.remove('d-none');
            }
        }
        
        function imprimirComprovante() {
            window.print();
        }
        
        function voltarInicio() {
            window.location.href = '/dashboard';
        }
        
        // Notificações do navegador (se suportado)
        function solicitarPermissaoNotificacao() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }
        
        function mostrarNotificacao(titulo, mensagem) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(titulo, {
                    body: mensagem,
                    icon: '/favicon.ico'
                });
            }
        }
        
        // Solicitar permissão para notificações ao carregar a página
        solicitarPermissaoNotificacao();
    </script>
</body>
</html>