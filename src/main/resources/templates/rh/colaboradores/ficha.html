<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ficha do Colaborador - ERP Corporativo</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" th:href="@{/css/style.css}" />
  <link rel="stylesheet" th:href="@{/css/sidebar.css}" />
  <link rel="stylesheet" th:href="@{/css/ficha-colaborador.css}" />

</head>

<body>
  <div class="app-container">
    <aside th:replace="~{components/sidebar :: sidebar}"></aside>

    <main class="main-content">
      <header th:replace="~{components/topbar :: topbar}"></header>

      <section class="content-area">
        <h1>Ficha do Colaborador</h1>
        <h2>Informações completas do colaborador</h2>

        <div class="action-buttons">
          <a href="/rh/colaboradores/listar" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Voltar à Lista
          </a>
          <a th:href="@{'/rh/colaboradores/editar/' + ${colaborador.id}}" class="btn btn-primary">
            <i class="fas fa-edit"></i> Editar
          </a>
          <button onclick="abrirModalPromocao()" class="btn btn-primary" th:if="${colaborador.status.name() == 'ATIVO'}">
            <i class="fas fa-edit"></i> Promover
          </button>
         
          <button onclick="imprimirFicha()" class="btn btn-success">
            <i class="fas fa-print"></i> Imprimir
          </button>
        </div>

        <div class="ficha-container">
          <!-- Cabeçalho da Ficha -->
          <div class="ficha-header">
            <div class="colaborador-foto">
              <img src="/img/gerente.png" alt="Foto do Colaborador"
                style="width:80px; height:80px; border-radius:50%; object-fit:cover;">
            </div>

            <div class="colaborador-info">
              <h2 th:text="${colaborador.nome}">Nome do Colaborador</h2>

              <div class="info-item" style="display:flex; gap:10px; align-items:center;">
                <label>Status:</label>
                <span class="status-badge status-ativo" th:text="${colaborador.status}">ATIVO</span>
              </div>
            </div>

            <div class="colaborador-stats">
              <div class="stat-item">
                <span class="stat-label">Tempo na Empresa</span>
                <span class="stat-value" th:text="${tempoNaEmpresa}">1 ano e 8 meses</span>
              </div>

              <div class="stat-item">
                <span class="stat-label">Último Acesso</span>
                <span class="stat-value" th:text="${ultimoAcesso}">Hoje, 14:30</span>
              </div>

            </div>
          </div>

          <!-- Dados Pessoais -->
          <div class="ficha-section">
            <h3><i class="fas fa-user"></i> Dados Pessoais</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>Nome Completo:</label>
                <span th:text="${colaborador.nome}">Nome do Colaborador</span>
              </div>
              <div class="info-item">
                <label>CPF:</label>
                <span th:text="${colaborador.cpf}">000.000.000-00</span>
              </div>
              <div class="info-item">
                <label>RG:</label>
                <span th:text="${colaborador.rg}">00.000.000-0</span>
              </div>
              <div class="info-item">
                <label>Data de Nascimento:</label>
                <span th:text="${colaborador.dataNascimento}">1996-07-28</span>
              </div>
              <div class="info-item">
                <label>Estado Civil:</label>
                <span th:text="${colaborador.estadoCivil}">Estado Civil</span>
              </div>
              <div class="info-item">
                <label>Sexo:</label>
                <span th:text="${colaborador.sexo}">Sexo</span>
              </div>
            </div>
          </div>



          <!-- Contato -->
          <div class="ficha-section">
            <h3><i class="fas fa-phone"></i> Informações de Contato</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>E-mail:</label>
                <span th:text="${colaborador.email}">E-mail</span>
              </div>
              <div class="info-item">
                <label>Telefone:</label>
                <span th:text="${colaborador.telefone}">Telefone</span>
              </div>

              <div class="info-item full-width">
                <label>Endereço:</label>
                <span
                  th:text="|${colaborador.logradouro}, ${colaborador.numero} ${colaborador.complemento} - ${colaborador.bairro} - ${colaborador.cidade}/${colaborador.estado} - CEP: ${colaborador.cep} - ${colaborador.pais}|">
                  Endereço completo
                </span>
              </div>


            </div>
          </div>

          <!-- Dados Profissionais -->
          <div class="ficha-section">
            <h3><i class="fas fa-briefcase"></i> Dados Profissionais</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>Cargo:</label>
                <span th:text="${colaborador.cargo.nome}">Cargo</span>
              </div>
              <div class="info-item">
                <label>Departamento:</label>
                <span th:text="${colaborador.departamento.nome}">Departamento</span>
              </div>
              <div class="info-item">
                <label>Data de Admissão:</label>
                <span th:text="${colaborador.dataAdmissao}">1996-07-28</span>
              </div>
              <div class="info-item">
                <label>Tipo de Contrato:</label>
                <span th:text="${colaborador.tipoContrato}">CLT</span>
              </div>
              <div class="info-item">
                <label>Carga Horária:</label>
                <span th:text="${colaborador.cargaHoraria + 'h semanais'}">40h semanais</span>
              </div>

              <div class="info-item">
                <label>Supervisor:</label>
                <span th:text="${colaborador.supervisor != null ? colaborador.supervisor.nome : 'Nenhum'}">
                  Nenhum
                </span>
              </div>

              <div class="info-item">
                <label>Salário:</label>
                <span th:text="'R$ ' + ${colaborador.salario}">R$ 8.500,00</span>
              </div>
              <div class="info-item" style="display:flex; gap:10px; align-items:center;">
                <label>Status:</label>
                <span class="status-badge status-ativo" th:text="${colaborador.status}">ATIVO</span>
              </div>
            </div>
          </div>


          <!-- Benefícios -->
          <!-- Benefícios -->
          <div class="ficha-section">
            <h3><i class="fas fa-gift"></i> Benefícios</h3>
            <div class="beneficios-list">
              <div th:each="benef : ${colaborador.beneficios}"
                th:classappend="${benef.status == 'ATIVO'} ? 'ativo' : 'inativo'" class="beneficio-item">

                <!-- Ícone conforme tipo de benefício -->
                <i th:class="${benef.beneficio.nome.contains('Saúde') ? 'fas fa-heartbeat' :
                         benef.beneficio.nome.contains('Transporte') ? 'fas fa-bus' :
                         benef.beneficio.nome.contains('Refeição') ? 'fas fa-utensils' : 'fas fa-gift'}"></i>

                <!-- Nome e status do benefício -->
                <div class="info-item">
                  <label th:text="${benef.beneficio.nome}">Plano de Saúde</label>
                  <span th:text="${benef.status}">Ativo</span>
                </div>
              </div>
            </div>
          </div>


          <!-- Histórico Recente -->
          <div class="ficha-section">

            <h3><i class="fas fa-history"></i> Histórico Recente</h3>
            <div class="historico-timeline">
              <!-- Exibir apenas os 3 registros mais recentes -->
              <div th:each="item, iterStat : ${historico}" th:if="${iterStat.index < 3}" class="timeline-item">
                <div class="timeline-date" th:text="${#temporals.format(item.dataRegistro, 'dd/MM/yyyy')}">Data</div>
                <div class="timeline-content">
                  <h4 th:text="${item.evento + (item.cargoNovo != null ? ' para ' + item.cargoNovo : '')}">Evento</h4>
                  <p th:text="${item.descricao}">Descrição do evento</p>
                  <!-- Detalhes adicionais se houver -->
                  <div th:if="${item.salarioAnterior != null and item.salarioNovo != null}" class="timeline-details">
                    <small th:text="'Salário: R$ ' + ${#numbers.formatDecimal(item.salarioAnterior, 1, 'COMMA', 2, 'POINT')} + ' → R$ ' + ${#numbers.formatDecimal(item.salarioNovo, 1, 'COMMA', 2, 'POINT')}">Detalhes salariais</small>
                  </div>
                </div>
              </div>
              
              <!-- Mensagem quando não há histórico -->
              <div th:if="${#lists.isEmpty(historico)}" class="timeline-item">
                <div class="timeline-date">-</div>
                <div class="timeline-content">
                  <h4>Nenhum histórico encontrado</h4>
                  <p>Este colaborador ainda não possui registros no histórico.</p>
                </div>
              </div>
              
              <!-- Link para ver histórico completo se houver mais de 3 registros -->
              <div th:if="${#lists.size(historico) > 3}" class="timeline-item" style="text-align: center; border: none;">
                <a th:href="@{'/rh/colaboradores/historico/' + ${colaborador.id}}" class="btn btn-link">
                  <i class="fas fa-eye"></i> Ver histórico completo (+ <span th:text="${#lists.size(historico) - 3}">0</span> registros)
                </a>
              </div>
            </div>
          </div>

          <!-- Observações -->
          <div class="ficha-section">
            <h3><i class="fas fa-sticky-note"></i> Observações</h3>
            <div class="observacoes-content">
              <p th:text="${colaborador.observacoes}">Observações do colaborador</p>
            </div>
          </div>

        </div>
      </section>

      <footer th:replace="~{components/footer :: footer}"></footer>
    </main>
  </div>

  <!-- Modal de Promoção -->
  <div id="modalPromocao" class="modal-promocao hidden" onclick="fecharModalPromocao(event)">
    <div class="modal-promocao-content" onclick="event.stopPropagation()">
      <div class="modal-promocao-header">
        <h3><i class="fas fa-arrow-up"></i> Promover Colaborador</h3>
        <button type="button" class="modal-promocao-close" onclick="fecharModalPromocao()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-promocao-body">
        <form id="formPromocao" th:action="@{/rh/colaboradores/promover/{id}(id=${colaborador.id})}" method="post">
          <div class="form-group">
            <label for="cargoAtual">Cargo Atual:</label>
            <select id="cargoAtual" disabled>
              <option th:value="${colaborador.cargo.id}" th:text="${colaborador.cargo.nome}" selected></option>
            </select>
          </div>
          
          <div class="form-group">
                    <label for="novoCargo">Novo Cargo:</label>
                    <select id="novoCargo" name="novoCargoId" required>
                        <option value="">Selecione o novo cargo</option>
                        <option th:each="cargo : ${cargos}" 
                                th:value="${cargo.id}" 
                                th:text="${cargo.nome}"
                                th:disabled="${cargo.id == colaborador.cargo.id}"></option>
                    </select>
                </div>
          
          <div class="form-group">
            <label for="novoSalario">Novo Salário:</label>
            <input type="number" id="novoSalario" name="novoSalario" 
                   th:value="${colaborador.salario}" 
                   step="0.01" min="0" required>
          </div>
          
          <div class="form-group">
            <label for="descricao">Descrição da Promoção:</label>
            <textarea id="descricao" name="descricao" 
                      placeholder="Descreva os motivos da promoção..."></textarea>
          </div>
        </form>
      </div>
      
      <div class="modal-promocao-footer">
        <button type="button" class="btn btn-secondary" onclick="fecharModalPromocao()">Cancelar</button>
        <button type="submit" form="formPromocao" class="btn btn-primary">Confirmar Promoção</button>
      </div>
    </div>
  </div>



  <script>
    function imprimirFicha() {
      window.print();
    }

    function abrirModalPromocao() {
      document.getElementById('modalPromocao').classList.remove('hidden');
    }

    function fecharModalPromocao(event) {
      if (event && event.target !== event.currentTarget) {
        return;
      }
      document.getElementById('modalPromocao').classList.add('hidden');
    }
  </script>

  <script th:src="@{/js/sidebar.js}"></script>

</body>

</html>