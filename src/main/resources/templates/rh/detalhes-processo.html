<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Processo - Portal CEO</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .status-badge {
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
        }
        
        .info-card {
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #dee2e6;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 25px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -23px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #007bff;
            border: 2px solid #fff;
            box-shadow: 0 0 0 2px #dee2e6;
        }
        
        .timeline-item.aprovado::before {
            background: #28a745;
        }
        
        .timeline-item.rejeitado::before {
            background: #dc3545;
        }
        
        .timeline-item.cancelado::before {
            background: #6c757d;
        }
        
        .custo-destaque {
            font-size: 1.5rem;
            font-weight: bold;
            color: #28a745;
        }
        
        .documento-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 8px;
            background: white;
        }
        
        .documento-item:hover {
            background: #f8f9fa;
        }
        
        .beneficio-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .beneficio-item:last-child {
            border-bottom: none;
        }
        
        .section-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 15px;
            border-radius: 8px 8px 0 0;
            margin-bottom: 0;
        }
        
        .section-content {
            background: white;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 20px;
        }
        
        .progress-bar-custom {
            height: 8px;
            border-radius: 4px;
        }
        
        .etapa-badge {
            font-size: 0.8rem;
            padding: 0.3rem 0.6rem;
        }
        
        .btn-action {
            min-width: 120px;
        }
        
        .alert-custom {
            border-left: 4px solid;
            border-radius: 0 8px 8px 0;
        }
        
        .alert-info-custom {
            border-left-color: #17a2b8;
            background-color: #d1ecf1;
        }
        
        .alert-warning-custom {
            border-left-color: #ffc107;
            background-color: #fff3cd;
        }
        
        .alert-success-custom {
            border-left-color: #28a745;
            background-color: #d4edda;
        }
        
        .alert-danger-custom {
            border-left-color: #dc3545;
            background-color: #f8d7da;
        }
    </style>
</head>
<body>
    <div th:replace="~{fragments/header :: header}"></div>
    
    <div class="container-fluid mt-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="/rh">RH</a></li>
                <li class="breadcrumb-item"><a href="/rh/aprovacao-processos">Aprovação de Processos</a></li>
                <li class="breadcrumb-item active">Detalhes do Processo</li>
            </ol>
        </nav>
        
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h2><i class="fas fa-user-plus me-2"></i>Detalhes do Processo de Adesão</h2>
                <p class="text-muted">Visualização completa do processo de adesão do colaborador</p>
            </div>
            <div class="col-md-4 text-end">
                <a href="/rh/aprovacao-processos" class="btn btn-outline-secondary me-2">
                    <i class="fas fa-arrow-left me-1"></i>Voltar
                </a>
                <button class="btn btn-outline-primary" onclick="atualizarDetalhes()">
                    <i class="fas fa-sync-alt me-1"></i>Atualizar
                </button>
            </div>
        </div>
        
        <!-- Loading -->
        <div class="text-center" id="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
            <p class="mt-2">Carregando detalhes do processo...</p>
        </div>
        
        <!-- Conteúdo Principal -->
        <div id="conteudo-principal" style="display: none;">
            <!-- Status e Progresso -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <div class="card">
                        <div class="section-header">
                            <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Status do Processo</h5>
                        </div>
                        <div class="section-content">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-3">
                                        <span class="me-3">Status Atual:</span>
                                        <span id="status-badge"></span>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <span class="me-3">Etapa Atual:</span>
                                        <span id="etapa-badge"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-2">
                                        <small class="text-muted">Progresso do Processo</small>
                                        <div class="progress progress-bar-custom">
                                            <div class="progress-bar" id="barra-progresso" role="progressbar"></div>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <small class="text-muted" id="texto-progresso"></small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="section-header">
                            <h5 class="mb-0"><i class="fas fa-calendar me-2"></i>Informações Temporais</h5>
                        </div>
                        <div class="section-content">
                            <p class="mb-2"><strong>Criado em:</strong><br><span id="data-criacao"></span></p>
                            <p class="mb-0"><strong>Última atualização:</strong><br><span id="data-atualizacao"></span></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Informações do Colaborador -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="section-header">
                            <h5 class="mb-0"><i class="fas fa-user me-2"></i>Dados do Colaborador</h5>
                        </div>
                        <div class="section-content" id="dados-colaborador">
                            <!-- Dados serão carregados via JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="section-header">
                            <h5 class="mb-0"><i class="fas fa-briefcase me-2"></i>Informações Profissionais</h5>
                        </div>
                        <div class="section-content" id="dados-profissionais">
                            <!-- Dados serão carregados via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dados Pessoais Detalhados -->
            <div class="card mb-4" id="secao-dados-pessoais" style="display: none;">
                <div class="section-header">
                    <h5 class="mb-0"><i class="fas fa-id-card me-2"></i>Dados Pessoais Completos</h5>
                </div>
                <div class="section-content" id="dados-pessoais-detalhados">
                    <!-- Dados serão carregados via JavaScript -->
                </div>
            </div>
            
            <!-- Documentos -->
            <div class="card mb-4" id="secao-documentos" style="display: none;">
                <div class="section-header">
                    <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Documentos Enviados</h5>
                </div>
                <div class="section-content" id="lista-documentos">
                    <!-- Documentos serão carregados via JavaScript -->
                </div>
            </div>
            
            <!-- Benefícios -->
            <div class="card mb-4" id="secao-beneficios" style="display: none;">
                <div class="section-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-gift me-2"></i>Benefícios Selecionados</h5>
                        <span class="custo-destaque" id="custo-total"></span>
                    </div>
                </div>
                <div class="section-content" id="lista-beneficios">
                    <!-- Benefícios serão carregados via JavaScript -->
                </div>
            </div>
            
            <!-- Observações -->
            <div class="card mb-4" id="secao-observacoes" style="display: none;">
                <div class="section-header">
                    <h5 class="mb-0"><i class="fas fa-comment me-2"></i>Observações</h5>
                </div>
                <div class="section-content">
                    <p id="texto-observacoes" class="mb-0"></p>
                </div>
            </div>
            
            <!-- Ações -->
            <div class="card mb-4" id="secao-acoes">
                <div class="section-header">
                    <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Ações Disponíveis</h5>
                </div>
                <div class="section-content">
                    <div class="d-flex gap-2 flex-wrap" id="botoes-acoes">
                        <!-- Botões serão carregados via JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Histórico -->
            <div class="card mb-4">
                <div class="section-header">
                    <h5 class="mb-0"><i class="fas fa-history me-2"></i>Histórico do Processo</h5>
                </div>
                <div class="section-content">
                    <div class="timeline" id="timeline-historico">
                        <!-- Histórico será carregado via JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mensagem de Erro -->
        <div class="alert alert-danger d-none" id="mensagem-erro">
            <h5><i class="fas fa-exclamation-triangle me-2"></i>Erro ao Carregar Processo</h5>
            <p class="mb-0" id="texto-erro"></p>
        </div>
    </div>
    
    <!-- Modal de Aprovação -->
    <div class="modal fade" id="modalAprovacao" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="fas fa-check-circle me-2"></i>Aprovar Processo</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="form-aprovacao">
                        <div class="mb-3">
                            <label class="form-label">Aprovado por *</label>
                            <input type="text" class="form-control" id="aprovado-por" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Observações</label>
                            <textarea class="form-control" id="observacoes-aprovacao" rows="3" placeholder="Observações sobre a aprovação (opcional)"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success btn-action" onclick="confirmarAprovacao()">
                        <i class="fas fa-check me-1"></i>Confirmar Aprovação
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Rejeição -->
    <div class="modal fade" id="modalRejeicao" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title"><i class="fas fa-times-circle me-2"></i>Rejeitar Processo</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="form-rejeicao">
                        <div class="mb-3">
                            <label class="form-label">Rejeitado por *</label>
                            <input type="text" class="form-control" id="rejeitado-por" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Motivo da rejeição *</label>
                            <textarea class="form-control" id="motivo-rejeicao" rows="4" required placeholder="Descreva o motivo da rejeição..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger btn-action" onclick="confirmarRejeicao()">
                        <i class="fas fa-times me-1"></i>Confirmar Rejeição
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <script>
        let processoAtual = null;
        let processoId = null;
        
        $(document).ready(function() {
            // Obter ID do processo da URL
            const urlParams = new URLSearchParams(window.location.search);
            processoId = urlParams.get('id');
            
            if (!processoId) {
                mostrarErro('ID do processo não fornecido');
                return;
            }
            
            carregarDetalhesProcesso();
        });
        
        function carregarDetalhesProcesso() {
            mostrarLoading(true);
            
            fetch(`/api/rh/processos-adesao/${processoId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Processo não encontrado');
                    }
                    return response.json();
                })
                .then(processo => {
                    processoAtual = processo;
                    exibirDetalhesProcesso(processo);
                    carregarHistoricoProcesso();
                    mostrarLoading(false);
                })
                .catch(error => {
                    console.error('Erro ao carregar processo:', error);
                    mostrarErro('Erro ao carregar detalhes do processo: ' + error.message);
                    mostrarLoading(false);
                });
        }
        
        function exibirDetalhesProcesso(processo) {
            // Status e progresso
            document.getElementById('status-badge').innerHTML = obterBadgeStatus(processo.status);
            document.getElementById('etapa-badge').innerHTML = obterBadgeEtapa(processo.etapaAtual);
            
            const progresso = calcularProgresso(processo.etapaAtual);
            const barraProgresso = document.getElementById('barra-progresso');
            barraProgresso.style.width = progresso.porcentagem + '%';
            barraProgresso.className = `progress-bar ${progresso.classe}`;
            document.getElementById('texto-progresso').textContent = progresso.texto;
            
            // Datas
            document.getElementById('data-criacao').textContent = formatarDataHora(processo.dataCriacao);
            document.getElementById('data-atualizacao').textContent = formatarDataHora(processo.dataAtualizacao);
            
            // Dados do colaborador
            document.getElementById('dados-colaborador').innerHTML = `
                <p class="mb-2"><strong>Nome:</strong> ${processo.nomeColaborador}</p>
                <p class="mb-2"><strong>Email:</strong> ${processo.emailColaborador}</p>
                <p class="mb-0"><strong>CPF:</strong> ${processo.cpfColaborador}</p>
            `;
            
            // Dados profissionais
            document.getElementById('dados-profissionais').innerHTML = `
                <p class="mb-2"><strong>Cargo:</strong> ${processo.cargo || 'Não informado'}</p>
                <p class="mb-2"><strong>Departamento:</strong> ${processo.departamento || 'Não informado'}</p>
                <p class="mb-0"><strong>Session ID:</strong> <code>${processo.sessionId}</code></p>
            `;
            
            // Dados pessoais detalhados
            if (processo.dadosPessoaisJson) {
                const dadosPessoais = JSON.parse(processo.dadosPessoaisJson);
                exibirDadosPessoais(dadosPessoais);
            }
            
            // Documentos
            if (processo.documentosJson) {
                const documentos = JSON.parse(processo.documentosJson);
                exibirDocumentos(documentos);
            }
            
            // Benefícios
            if (processo.beneficiosJson) {
                const beneficios = JSON.parse(processo.beneficiosJson);
                exibirBeneficios(beneficios, processo.custoTotalMensal);
            }
            
            // Observações
            if (processo.observacoes) {
                document.getElementById('secao-observacoes').style.display = 'block';
                document.getElementById('texto-observacoes').textContent = processo.observacoes;
            }
            
            // Ações disponíveis
            exibirAcoesDisponiveis(processo.status);
            
            document.getElementById('conteudo-principal').style.display = 'block';
        }
        
        function exibirDadosPessoais(dados) {
            let html = '<div class="row">';
            
            Object.entries(dados).forEach(([key, value]) => {
                if (key !== 'nome' && key !== 'email' && key !== 'cpf' && value) {
                    html += `
                        <div class="col-md-6 mb-2">
                            <strong>${formatarCampo(key)}:</strong> ${value}
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            
            if (Object.keys(dados).length > 3) {
                document.getElementById('secao-dados-pessoais').style.display = 'block';
                document.getElementById('dados-pessoais-detalhados').innerHTML = html;
            }
        }
        
        function exibirDocumentos(documentos) {
            if (Object.keys(documentos).length === 0) return;
            
            let html = '';
            
            Object.entries(documentos).forEach(([key, value]) => {
                html += `
                    <div class="documento-item">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-file-pdf text-danger me-3"></i>
                            <div>
                                <strong>${formatarCampo(key)}</strong><br>
                                <small class="text-muted">${value}</small>
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-primary" onclick="visualizarDocumento('${value}')">
                                <i class="fas fa-eye me-1"></i>Visualizar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('secao-documentos').style.display = 'block';
            document.getElementById('lista-documentos').innerHTML = html;
        }
        
        function exibirBeneficios(beneficios, custoTotal) {
            if (Object.keys(beneficios).length === 0) return;
            
            let html = '';
            
            Object.entries(beneficios).forEach(([key, value]) => {
                html += `
                    <div class="beneficio-item">
                        <div>
                            <strong>${formatarCampo(key)}</strong>
                        </div>
                        <div class="text-success">
                            <strong>${value}</strong>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('secao-beneficios').style.display = 'block';
            document.getElementById('lista-beneficios').innerHTML = html;
            
            if (custoTotal) {
                document.getElementById('custo-total').textContent = 
                    'R$ ' + custoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            }
        }
        
        function exibirAcoesDisponiveis(status) {
            const botoesAcoes = document.getElementById('botoes-acoes');
            let html = '';
            
            if (status === 'AGUARDANDO_APROVACAO') {
                html += `
                    <button class="btn btn-success btn-action" onclick="mostrarModalAprovacao()">
                        <i class="fas fa-check me-1"></i>Aprovar
                    </button>
                    <button class="btn btn-danger btn-action" onclick="mostrarModalRejeicao()">
                        <i class="fas fa-times me-1"></i>Rejeitar
                    </button>
                `;
            }
            
            html += `
                <button class="btn btn-outline-primary btn-action" onclick="imprimirProcesso()">
                    <i class="fas fa-print me-1"></i>Imprimir
                </button>
                <button class="btn btn-outline-info btn-action" onclick="exportarPdf()">
                    <i class="fas fa-file-pdf me-1"></i>Exportar PDF
                </button>
            `;
            
            botoesAcoes.innerHTML = html;
        }
        
        function carregarHistoricoProcesso() {
            fetch(`/api/rh/processos-adesao/${processoId}/historico`)
                .then(response => response.json())
                .then(historico => {
                    exibirHistorico(historico);
                })
                .catch(error => {
                    console.error('Erro ao carregar histórico:', error);
                });
        }
        
        function exibirHistorico(historico) {
            const timeline = document.getElementById('timeline-historico');
            
            if (historico.length === 0) {
                timeline.innerHTML = '<p class="text-muted">Nenhum evento registrado no histórico.</p>';
                return;
            }
            
            let html = '';
            
            historico.forEach(evento => {
                const classeEvento = obterClasseEvento(evento.tipoEvento);
                const dataFormatada = formatarDataHora(evento.dataEvento);
                
                html += `
                    <div class="timeline-item ${classeEvento}">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="mb-0">${evento.descricao}</h6>
                            <small class="text-muted">${dataFormatada}</small>
                        </div>
                        
                        ${evento.usuarioResponsavel ? `
                            <p class="mb-1"><strong>Responsável:</strong> ${evento.usuarioResponsavel}</p>
                        ` : ''}
                        
                        ${evento.etapaAnterior && evento.etapaAtual ? `
                            <p class="mb-1">
                                <strong>Etapa:</strong> 
                                <span class="text-muted">${evento.etapaAnterior}</span> 
                                <i class="fas fa-arrow-right mx-2"></i> 
                                <span class="text-primary">${evento.etapaAtual}</span>
                            </p>
                        ` : ''}
                        
                        ${evento.statusAnterior && evento.statusAtual ? `
                            <p class="mb-1">
                                <strong>Status:</strong> 
                                <span class="text-muted">${evento.statusAnterior}</span> 
                                <i class="fas fa-arrow-right mx-2"></i> 
                                <span class="text-primary">${evento.statusAtual}</span>
                            </p>
                        ` : ''}
                        
                        ${evento.observacoes ? `
                            <div class="alert alert-light mt-2 mb-0">
                                <small><strong>Observações:</strong> ${evento.observacoes}</small>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            timeline.innerHTML = html;
        }
        
        function calcularProgresso(etapa) {
            const etapas = {
                'inicio': { porcentagem: 10, classe: 'bg-info', texto: 'Processo iniciado' },
                'dados-pessoais': { porcentagem: 25, classe: 'bg-info', texto: 'Dados pessoais coletados' },
                'documentos': { porcentagem: 50, classe: 'bg-warning', texto: 'Documentos enviados' },
                'beneficios': { porcentagem: 75, classe: 'bg-warning', texto: 'Benefícios selecionados' },
                'revisao': { porcentagem: 90, classe: 'bg-primary', texto: 'Em revisão' },
                'finalizado': { porcentagem: 100, classe: 'bg-success', texto: 'Processo finalizado' }
            };
            
            return etapas[etapa] || { porcentagem: 0, classe: 'bg-secondary', texto: 'Etapa desconhecida' };
        }
        
        function obterBadgeStatus(status) {
            const badges = {
                'EM_ANDAMENTO': '<span class="badge bg-primary status-badge">Em Andamento</span>',
                'AGUARDANDO_APROVACAO': '<span class="badge bg-warning status-badge">Aguardando Aprovação</span>',
                'APROVADO': '<span class="badge bg-success status-badge">Aprovado</span>',
                'REJEITADO': '<span class="badge bg-danger status-badge">Rejeitado</span>',
                'CANCELADO': '<span class="badge bg-secondary status-badge">Cancelado</span>'
            };
            return badges[status] || '<span class="badge bg-secondary status-badge">Desconhecido</span>';
        }
        
        function obterBadgeEtapa(etapa) {
            const badges = {
                'inicio': '<span class="badge bg-info etapa-badge">Início</span>',
                'dados-pessoais': '<span class="badge bg-primary etapa-badge">Dados Pessoais</span>',
                'documentos': '<span class="badge bg-warning etapa-badge">Documentos</span>',
                'beneficios': '<span class="badge bg-info etapa-badge">Benefícios</span>',
                'revisao': '<span class="badge bg-primary etapa-badge">Revisão</span>',
                'finalizado': '<span class="badge bg-success etapa-badge">Finalizado</span>'
            };
            return badges[etapa] || '<span class="badge bg-secondary etapa-badge">Desconhecida</span>';
        }
        
        function obterClasseEvento(tipoEvento) {
            const classes = {
                'APROVACAO': 'aprovado',
                'REJEICAO': 'rejeitado',
                'CANCELAMENTO': 'cancelado'
            };
            return classes[tipoEvento] || '';
        }
        
        function formatarCampo(campo) {
            return campo.replace(/([A-Z])/g, ' $1')
                       .replace(/^./, str => str.toUpperCase())
                       .replace(/\b\w/g, l => l.toUpperCase());
        }
        
        function formatarDataHora(dataString) {
            return new Date(dataString).toLocaleString('pt-BR');
        }
        
        function mostrarModalAprovacao() {
            new bootstrap.Modal(document.getElementById('modalAprovacao')).show();
        }
        
        function mostrarModalRejeicao() {
            new bootstrap.Modal(document.getElementById('modalRejeicao')).show();
        }
        
        function confirmarAprovacao() {
            const aprovadoPor = document.getElementById('aprovado-por').value.trim();
            const observacoes = document.getElementById('observacoes-aprovacao').value.trim();
            
            if (!aprovadoPor) {
                alert('Campo "Aprovado por" é obrigatório');
                return;
            }
            
            const dados = {
                aprovadoPor: aprovadoPor,
                observacoes: observacoes
            };
            
            fetch(`/api/rh/processos-adesao/${processoId}/aprovar`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dados)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Processo aprovado com sucesso!');
                    bootstrap.Modal.getInstance(document.getElementById('modalAprovacao')).hide();
                    atualizarDetalhes();
                } else {
                    alert(data.message || 'Erro ao aprovar processo');
                }
            })
            .catch(error => {
                console.error('Erro ao aprovar processo:', error);
                alert('Erro ao aprovar processo');
            });
        }
        
        function confirmarRejeicao() {
            const rejeitadoPor = document.getElementById('rejeitado-por').value.trim();
            const motivoRejeicao = document.getElementById('motivo-rejeicao').value.trim();
            
            if (!rejeitadoPor) {
                alert('Campo "Rejeitado por" é obrigatório');
                return;
            }
            
            if (!motivoRejeicao) {
                alert('Campo "Motivo da rejeição" é obrigatório');
                return;
            }
            
            const dados = {
                rejeitadoPor: rejeitadoPor,
                motivoRejeicao: motivoRejeicao
            };
            
            fetch(`/api/rh/processos-adesao/${processoId}/rejeitar`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dados)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Processo rejeitado com sucesso!');
                    bootstrap.Modal.getInstance(document.getElementById('modalRejeicao')).hide();
                    atualizarDetalhes();
                } else {
                    alert(data.message || 'Erro ao rejeitar processo');
                }
            })
            .catch(error => {
                console.error('Erro ao rejeitar processo:', error);
                alert('Erro ao rejeitar processo');
            });
        }
        
        function visualizarDocumento(nomeArquivo) {
            // Implementar visualização de documento
            alert('Funcionalidade de visualização de documento será implementada');
        }
        
        function imprimirProcesso() {
            window.print();
        }
        
        function exportarPdf() {
            // Implementar exportação para PDF
            alert('Funcionalidade de exportação para PDF será implementada');
        }
        
        function atualizarDetalhes() {
            carregarDetalhesProcesso();
        }
        
        function mostrarLoading(mostrar) {
            const loading = document.getElementById('loading');
            const conteudo = document.getElementById('conteudo-principal');
            const erro = document.getElementById('mensagem-erro');
            
            if (mostrar) {
                loading.style.display = 'block';
                conteudo.style.display = 'none';
                erro.classList.add('d-none');
            } else {
                loading.style.display = 'none';
            }
        }
        
        function mostrarErro(mensagem) {
            const loading = document.getElementById('loading');
            const conteudo = document.getElementById('conteudo-principal');
            const erro = document.getElementById('mensagem-erro');
            const textoErro = document.getElementById('texto-erro');
            
            loading.style.display = 'none';
            conteudo.style.display = 'none';
            erro.classList.remove('d-none');
            textoErro.textContent = mensagem;
        }
    </script>
</body>
</html>