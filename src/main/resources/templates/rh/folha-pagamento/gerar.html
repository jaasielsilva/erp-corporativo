<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerar Folha de Pagamento - ERP Corporativo</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" th:href="@{/css/style.css}" />
  <link rel="stylesheet" th:href="@{/css/sidebar.css}" />
</head>

<body>
  <div class="app-container">
    <aside th:replace="~{components/sidebar :: sidebar}"></aside>

    <main class="main-content">
      <header th:replace="~{components/topbar :: topbar}"></header>

      <section class="content-area">
        <div th:if="${mensagem}" class="alert alert-success" role="alert">
          <i class="fas fa-check-circle"></i>
          <span th:text="${mensagem}"></span>
        </div>
        <div th:if="${erro}" class="alert alert-danger" role="alert">
          <i class="fas fa-exclamation-triangle"></i>
          <span th:text="${erro}"></span>
        </div>

        <div class="alert-container-right">
          <div th:if="${mensagem}" class="alert alert-success" role="alert">
            <i class="fas fa-check-circle"></i>
            <span th:text="${mensagem}"></span>
          </div>
          <div th:if="${erro}" class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            <span th:text="${erro}"></span>
          </div>
        </div>
        <h1>Gerar Folha de Pagamento</h1>
        <h2>Processamento da folha mensal</h2>

        <div class="action-buttons">
          <a href="/rh/folha-pagamento/relatorios" class="btn btn-secondary">
            <i class="fas fa-chart-bar"></i> Ver Relatórios
          </a>
          <a href="/rh/folha-pagamento/listar" class="btn btn-info">
            <i class="fas fa-history"></i> Histórico
          </a>
        </div>

        <!-- Configurações da Folha -->
        <article class="card">
          <h3><i class="fas fa-cog"></i> Configurações da Folha</h3>
          <div th:if="${existeFolhaAtual}" class="alert alert-warning" role="alert">
            Já existe folha para <span th:text="${mesAtual}"></span>/<span th:text="${anoAtual}"></span>.
          </div>
          <form class="form-container" th:action="@{/rh/folha-pagamento/processar}" method="post">
            <div class="form-row">
              <div class="form-group">
                <label for="mesReferencia">Mês de Referência *</label>
                <select id="mesReferencia" name="mes" required class="form-control">
                  <option th:each="m : ${#numbers.sequence(1,12)}" th:value="${m}" th:text="${m}"></option>
                </select>
              </div>
              <div class="form-group">
                <label for="anoReferencia">Ano de Referência *</label>
                <select id="anoReferencia" name="ano" required class="form-control">
                  <option th:each="a : ${#numbers.sequence(anoAtual-2,anoAtual+1)}" th:value="${a}" th:text="${a}"
                    th:selected="${a == anoAtual}"></option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="departamento">Departamento</label>
                <select id="departamento" name="departamento" class="form-control">
                  <option value="">Todos os departamentos</option>
                  <option th:each="d : ${departamentos}" th:value="${d.id}" th:text="${d.nome}"></option>
                </select>
              </div>
              <div class="form-group">
                <label for="tipoFolha">Tipo de Folha</label>
                <select id="tipoFolha" name="tipoFolha" class="form-control">
                  <option value="normal" selected>Folha Normal</option>
                  <option value="complementar">Folha Complementar</option>
                  <option value="decimo_terceiro">13º Salário</option>
                  <option value="ferias">Férias</option>
                </select>
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary" th:disabled="${existeFolhaAtual}">
                <i class="fas fa-cogs"></i> Processar Folha
              </button>
            </div>
          </form>
        </article>

        <!-- Resumo dos Colaboradores -->
        <article class="card">
          <h3><i class="fas fa-users"></i> Colaboradores Incluídos</h3>
          <div class="colaboradores-resumo">
            <div class="resumo-stats">
              <div class="stat-item">
                <span class="stat-number">15</span>
                <span class="stat-label">Total de Colaboradores</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">12</span>
                <span class="stat-label">CLT</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">2</span>
                <span class="stat-label">PJ</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">1</span>
                <span class="stat-label">Estagiário</span>
              </div>
            </div>
          </div>

          <table class="table-list">
            <thead>
              <tr>
                <th>Colaborador</th>
                <th>Cargo</th>
                <th>Departamento</th>
                <th>Salário Base</th>
                <th>Dias Trabalhados</th>
                <th>Status</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="c : ${colaboradoresResumo}">

                <td th:text="${c.nome}"></td>

                <td th:text="${c.cargoNome}"></td>

                <td th:text="${c.departamentoNome}"></td>

                <td th:text="${c.salario != null ? #numbers.formatDecimal(c.salario, 1, 'POINT', 2, 'COMMA') : '0,00'}">
                </td>

                <td th:text="${(c.diasTrabalhados != null ? c.diasTrabalhados : 0) + '/' + (c.diasUteisMes != null ? c.diasUteisMes : 0)}"></td>

                <td>
                  <span class="status-badge" th:classappend="${c.status == 'ATIVO' ? ' status-ativo' : (c.status == 'SUSPENSO' ? ' status-afastado' : ' status-ferias')}">
                    <span th:text="${c.status}"></span>
                  </span>
                </td>

                <td>
                  <button class="btn-icon" title="Ver Detalhes"
                    th:onclick="'window.location.href=\'/folha/detalhes/' + c.id + '\';'">
                    <i class="fas fa-eye"></i>
                  </button>

                  <button class="btn-icon" title="Editar"
                    th:onclick="'window.location.href=\'/folha/editar/' + c.id + '\';'">
                    <i class="fas fa-edit"></i>
                  </button>
                </td>

              </tr>
            </tbody>



          </table>
        </article>

        <!-- Resumo Financeiro -->
        <article class="card">
          <h3><i class="fas fa-money-bill-wave"></i> Resumo Financeiro</h3>
          <div class="resumo-financeiro">
            <div class="resumo-grid">
              <div class="resumo-item proventos">
                <h4><i class="fas fa-plus-circle"></i> Proventos</h4>
                <div class="valor-principal">R$ 145.750,00</div>
                <div class="detalhes">
                  <span>Salários: R$ 132.500,00</span>
                  <span>Horas Extras: R$ 8.250,00</span>
                  <span>Comissões: R$ 5.000,00</span>
                </div>
              </div>

              <div class="resumo-item descontos">
                <h4><i class="fas fa-minus-circle"></i> Descontos</h4>
                <div class="valor-principal">R$ 32.450,00</div>
                <div class="detalhes">
                  <span>INSS: R$ 18.200,00</span>
                  <span>IRRF: R$ 12.750,00</span>
                  <span>Outros: R$ 1.500,00</span>
                </div>
              </div>

              <div class="resumo-item liquido">
                <h4><i class="fas fa-hand-holding-usd"></i> Valor Líquido</h4>
                <div class="valor-principal">R$ 113.300,00</div>
                <div class="detalhes">
                  <span>Valor a pagar aos colaboradores</span>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Ações da Folha -->
        <article class="card">
          <h3><i class="fas fa-tasks"></i> Ações da Folha</h3>
          <div class="acoes-folha">
            <div class="acao-item">
              <div class="acao-info">
                <h4>1. Calcular Folha</h4>
                <p>Processar cálculos de salários, descontos e benefícios</p>
              </div>
              <button onclick="calcularFolha()" class="btn btn-primary">
                <i class="fas fa-calculator"></i> Calcular
              </button>
            </div>

            <div class="acao-item">
              <div class="acao-info">
                <h4>2. Revisar Cálculos</h4>
                <p>Verificar e validar todos os cálculos realizados</p>
              </div>
              <button onclick="revisarCalculos()" class="btn btn-warning" disabled>
                <i class="fas fa-search"></i> Revisar
              </button>
            </div>

            <div class="acao-item">
              <div class="acao-info">
                <h4>3. Gerar Holerites</h4>
                <p>Criar holerites individuais para cada colaborador</p>
              </div>
              <button onclick="gerarHolerites()" class="btn btn-info" disabled>
                <i class="fas fa-file-invoice"></i> Gerar Holerites
              </button>
            </div>

            <div class="acao-item">
              <div class="acao-info">
                <h4>4. Aprovar Folha</h4>
                <p>Aprovar a folha para processamento final</p>
              </div>
              <button onclick="aprovarFolha()" class="btn btn-success" disabled>
                <i class="fas fa-check"></i> Aprovar
              </button>
            </div>
          </div>
        </article>
      </section>

      <footer th:replace="~{components/footer :: footer}"></footer>
    </main>
  </div>

  <script th:src="@{/js/script.js}"></script>
  <script>
    let etapaAtual = 0;

    function calcularFolha() {
      // Simular processamento
      const btn = event.target;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Calculando...';
      btn.disabled = true;

      setTimeout(() => {
        btn.innerHTML = '<i class="fas fa-check"></i> Calculado';
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-success');

        // Habilitar próxima etapa
        document.querySelector('button[onclick="revisarCalculos()"]').disabled = false;
        etapaAtual = 1;

        alert('Folha calculada com sucesso!');
      }, 3000);
    }

    function revisarCalculos() {
      if (etapaAtual >= 1) {
        alert('Cálculos revisados e aprovados!');
        document.querySelector('button[onclick="gerarHolerites()"]').disabled = false;
        etapaAtual = 2;
      }
    }

    function gerarHolerites() {
      if (etapaAtual >= 2) {
        alert('Holerites gerados com sucesso!');
        document.querySelector('button[onclick="aprovarFolha()"]').disabled = false;
        etapaAtual = 3;
      }
    }

    function aprovarFolha() {
      if (etapaAtual >= 3) {
        if (confirm('Tem certeza que deseja aprovar a folha de pagamento? Esta ação não pode ser desfeita.')) {
          alert('Folha de pagamento aprovada e processada!');
        }
      }
    }
  </script>
  <!-- jQuery e notificações (deduplicados) -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script th:src="@{/js/sidebar.js}"></script>

</body>

</html>