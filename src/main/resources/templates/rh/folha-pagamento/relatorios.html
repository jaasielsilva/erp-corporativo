<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Relatórios de Folha - ERP Corporativo</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/sidebar.css" rel="stylesheet">
    <link href="/css/notifications.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

<body>
  <div class="app-container">
    <aside th:replace="~{components/sidebar :: sidebar}"></aside>

    <main class="main-content">
      <header th:replace="~{components/topbar :: topbar}"></header>

      <section class="content-area">
        <h1>Relatórios de Folha de Pagamento</h1>
        <h2>Análises e relatórios detalhados</h2>

        <div class="action-buttons">
          <a href="/rh/folha-pagamento/gerar" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Voltar
          </a>
          <button onclick="exportarTodosRelatorios()" class="btn btn-success">
            <i class="fas fa-download"></i> Exportar Todos
          </button>
        </div>

        <!-- Filtros Gerais -->
        <article class="card">
          <h3><i class="fas fa-filter"></i> Filtros</h3>
          <form class="form-container" method="get" action="/rh/folha-pagamento/relatorios">
            <div class="form-row">
              <div class="form-group">
                <label for="periodoInicio">Período - Início</label>
                <input type="month" id="periodoInicio" name="periodoInicio" class="form-control" value="2023-01">
              </div>
              <div class="form-group">
                <label for="periodoFim">Período - Fim</label>
                <input type="month" id="periodoFim" name="periodoFim" class="form-control" value="2023-11">
              </div>
              <div class="form-group">
                <label for="departamentoRel">Departamento</label>
                <select id="departamentoRel" name="departamentoId" class="form-control">
                  <option value="">Todos os departamentos</option>
                  <option th:each="d : ${departamentos}" th:value="${d.id}" th:text="${d.nome}"></option>
                </select>
              </div>
              <div class="form-group">
                <label for="tipoFolhaRel">Tipo de Folha</label>
                <select id="tipoFolhaRel" name="tipoFolha" class="form-control">
                  <option value="normal" th:selected="${tipoFolhaSelecionado == 'normal'}">Folha Normal</option>
                  <option value="complementar" th:selected="${tipoFolhaSelecionado == 'complementar'}">Folha Complementar</option>
                  <option value="decimo_terceiro" th:selected="${tipoFolhaSelecionado == 'decimo_terceiro'}">13º Salário</option>
                  <option value="ferias" th:selected="${tipoFolhaSelecionado == 'ferias'}">Férias</option>
                </select>
              </div>
              <div class="form-group" style="min-width:280px">
                <label for="folhaSelecionada">Folhas Recentes</label>
                <select id="folhaSelecionada" class="form-control">
                  <option value="" selected>Selecione uma folha...</option>
                  <option th:each="f : ${folhasRecentes}"
                          th:value="${f.id}"
                          th:text="${(f.mesReferencia != null ? f.mesReferencia : '') + '/' + (f.anoReferencia != null ? f.anoReferencia : '') + ' - ' + (f.tipoFolha != null ? f.tipoFolha : 'normal')}"></option>
                </select>
              </div>
              <div class="form-group">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-sync"></i> Atualizar
                </button>
              </div>
            </div>
          </form>
        </article>

        <!-- Resumo Executivo -->
        <article class="card">
          <h3><i class="fas fa-chart-line"></i> Resumo Executivo</h3>
          <div class="resumo-executivo" th:if="${resumoAtual}">
            <div class="resumo-grid">
              <div class="resumo-card salarios">
                <div class="resumo-icon">
                  <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="resumo-info">
                  <h4>Total Salários</h4>
                  <div class="resumo-valor" th:text="${#numbers.formatCurrency(resumoAtual.totalProventos)}"></div>
                  <div class="resumo-variacao positiva">
                    <i class="fas fa-arrow-up"></i> +5.2% vs mês anterior
                  </div>
                </div>
              </div>
              
              <div class="resumo-card descontos">
                <div class="resumo-icon">
                  <i class="fas fa-minus-circle"></i>
                </div>
                <div class="resumo-info">
                  <h4>Total Descontos</h4>
                  <div class="resumo-valor" th:text="${#numbers.formatCurrency(resumoAtual.totalDescontos)}"></div>
                  <div class="resumo-variacao negativa">
                    <i class="fas fa-arrow-down"></i> -2.1% vs mês anterior
                  </div>
                </div>
              </div>
              
              <div class="resumo-card liquido">
                <div class="resumo-icon">
                  <i class="fas fa-hand-holding-usd"></i>
                </div>
                <div class="resumo-info">
                  <h4>Folha Líquida</h4>
                  <div class="resumo-valor" th:text="${#numbers.formatCurrency(resumoAtual.totalLiquido)}"></div>
                  <div class="resumo-variacao positiva">
                    <i class="fas fa-arrow-up"></i> +7.8% vs mês anterior
                  </div>
                </div>
              </div>
              
              <div class="resumo-card colaboradores">
                <div class="resumo-icon">
                  <i class="fas fa-users"></i>
                </div>
                <div class="resumo-info">
                  <h4>Colaboradores</h4>
                  <div class="resumo-valor" th:text="${resumoAtual.quantidadeHolerites}"></div>
                  <div class="resumo-variacao neutra">
                    <i class="fas fa-minus"></i> Sem alteração
                  </div>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Gráficos -->
        <div class="charts-container">
          <article class="card chart-card">
            <h3><i class="fas fa-chart-bar"></i> Evolução da Folha de Pagamento</h3>
            <div class="chart-help" id="helpEvolucao" style="display:none">Falha ao carregar dados para o período selecionado</div>
            <div class="chart-wrapper">
              <canvas id="chartEvolucaoFolha" style="width:100%; height:220px; display:block; margin:0 auto"></canvas>
              <div class="chart-empty" id="emptyEvolucao" style="display:none">Sem dados disponíveis</div>
            </div>
          </article>
          
          <article class="card chart-card">
            <h3><i class="fas fa-chart-pie"></i> Distribuição por Departamento</h3>
            <div class="chart-help" id="helpDepartamentos" style="display:none">Falha ao carregar dados para o período selecionado</div>
            <div class="chart-wrapper">
              <canvas id="chartDepartamentos" style="width:100%; height:220px; display:block; margin:0 auto"></canvas>
              <div class="chart-empty" id="emptyDepartamentos" style="display:none">Sem dados disponíveis</div>
            </div>
          </article>
        </div>

        <!-- Relatórios Disponíveis -->
        <article class="card">
          <h3><i class="fas fa-file-alt"></i> Relatórios Disponíveis</h3>
          <div class="relatorios-grid">
            <div class="relatorio-item">
              <div class="relatorio-icon">
                <i class="fas fa-file-invoice-dollar"></i>
              </div>
              <div class="relatorio-info">
                <h4>Folha de Pagamento Analítica</h4>
                <p>Relatório detalhado com todos os colaboradores, proventos e descontos</p>
                <div class="relatorio-actions">
                  <button onclick="gerarRelatorio('analitica', 'visualizar')" class="btn btn-info btn-sm">
                    <i class="fas fa-eye"></i> Visualizar
                  </button>
                  <button onclick="gerarRelatorio('analitica')" class="btn btn-primary btn-sm">
                    <i class="fas fa-file-pdf"></i> PDF
                  </button>
                  <button onclick="gerarRelatorio('analitica', 'excel')" class="btn btn-success btn-sm">
                    <i class="fas fa-file-excel"></i> Excel
                  </button>
                </div>
              </div>
            </div>
            
            <div class="relatorio-item">
              <div class="relatorio-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="relatorio-info">
                <h4>Resumo Gerencial</h4>
                <p>Visão executiva com totais e indicadores principais</p>
                <div class="relatorio-actions">
                  <button onclick="gerarRelatorio('gerencial', 'visualizar')" class="btn btn-info btn-sm">
                    <i class="fas fa-eye"></i> Visualizar
                  </button>
                  <button onclick="gerarRelatorio('gerencial')" class="btn btn-primary btn-sm">
                    <i class="fas fa-file-pdf"></i> PDF
                  </button>
                  <button onclick="gerarRelatorio('gerencial', 'excel')" class="btn btn-success btn-sm">
                    <i class="fas fa-file-excel"></i> Excel
                  </button>
                </div>
              </div>
            </div>
            
            <div class="relatorio-item">
              <div class="relatorio-icon">
                <i class="fas fa-university"></i>
              </div>
              <div class="relatorio-info">
                <h4>Obrigações Trabalhistas</h4>
                <p>INSS, IRRF, FGTS e demais obrigações por colaborador</p>
                <div class="relatorio-actions">
                  <button onclick="gerarRelatorio('obrigacoes', 'visualizar')" class="btn btn-info btn-sm">
                    <i class="fas fa-eye"></i> Visualizar
                  </button>
                  <button onclick="gerarRelatorio('obrigacoes')" class="btn btn-primary btn-sm">
                    <i class="fas fa-file-pdf"></i> PDF
                  </button>
                  <button onclick="gerarRelatorio('obrigacoes', 'excel')" class="btn btn-success btn-sm">
                    <i class="fas fa-file-excel"></i> Excel
                  </button>
                </div>
              </div>
            </div>
            
            <div class="relatorio-item">
              <div class="relatorio-icon">
                <i class="fas fa-building"></i>
              </div>
              <div class="relatorio-info">
                <h4>Por Departamento</h4>
                <p>Análise de custos e colaboradores por departamento</p>
                <div class="relatorio-actions">
                  <button onclick="gerarRelatorio('departamento', 'visualizar')" class="btn btn-info btn-sm">
                    <i class="fas fa-eye"></i> Visualizar
                  </button>
                  <button onclick="gerarRelatorio('departamento')" class="btn btn-primary btn-sm">
                    <i class="fas fa-file-pdf"></i> PDF
                  </button>
                  <button onclick="gerarRelatorio('departamento', 'excel')" class="btn btn-success btn-sm">
                    <i class="fas fa-file-excel"></i> Excel
                  </button>
                </div>
              </div>
            </div>
            
            <div class="relatorio-item">
              <div class="relatorio-icon">
                <i class="fas fa-calendar-alt"></i>
              </div>
              <div class="relatorio-info">
                <h4>Comparativo Mensal</h4>
                <p>Evolução da folha nos últimos 12 meses</p>
                <div class="relatorio-actions">
                  <button onclick="gerarRelatorio('comparativo', 'visualizar')" class="btn btn-info btn-sm">
                    <i class="fas fa-eye"></i> Visualizar
                  </button>
                  <button onclick="gerarRelatorio('comparativo')" class="btn btn-primary btn-sm">
                    <i class="fas fa-file-pdf"></i> PDF
                  </button>
                  <button onclick="gerarRelatorio('comparativo', 'excel')" class="btn btn-success btn-sm">
                    <i class="fas fa-file-excel"></i> Excel
                  </button>
                </div>
              </div>
            </div>
            
            <div class="relatorio-item">
              <div class="relatorio-icon">
                <i class="fas fa-heart"></i>
              </div>
              <div class="relatorio-info">
                <h4>Benefícios</h4>
                <p>Relatório de benefícios concedidos e seus custos</p>
                <div class="relatorio-actions">
                  <button onclick="gerarRelatorio('beneficios', 'visualizar')" class="btn btn-info btn-sm">
                    <i class="fas fa-eye"></i> Visualizar
                  </button>
                  <button onclick="gerarRelatorio('beneficios')" class="btn btn-primary btn-sm">
                    <i class="fas fa-file-pdf"></i> PDF
                  </button>
                  <button onclick="gerarRelatorio('beneficios', 'excel')" class="btn btn-success btn-sm">
                    <i class="fas fa-file-excel"></i> Excel
                  </button>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Tabela Detalhada -->
        <article class="card">
          <h3><i class="fas fa-table"></i> Detalhamento da Folha Atual</h3>
          <div class="action-buttons" style="margin-bottom:12px;">
            <div class="search-box">
              <input id="buscarHoleriteRel" type="text" placeholder="Buscar por nome ou departamento" autocomplete="off" />
            </div>
          </div>
          <div class="table-responsive">
            <div id="holeritesLoadingRel" class="loading" style="display:none"><i class="fas fa-spinner fa-spin"></i> Carregando...</div>
            <table class="table-list">
              <thead>
                <tr>
                  <th>Colaborador</th>
                  <th>Departamento</th>
                  <th>Salário Base</th>
                  <th>Proventos</th>
                  <th>Descontos</th>
                  <th>Líquido</th>
                  <th>% Desconto</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="tbodyHolerites"></tbody>
              <tfoot>
                <tr class="total-row">
                  <td colspan="2"><strong>TOTAIS</strong></td>
                  <td><strong id="totalSalarioBase">R$ 0,00</strong></td>
                  <td><strong id="totalProventos">R$ 0,00</strong></td>
                  <td><strong id="totalDescontos">R$ 0,00</strong></td>
                  <td><strong id="totalLiquido">R$ 0,00</strong></td>
                  <td><strong id="percentualDesconto">0%</strong></td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </article>
        <div class="pagination-tools" style="display:flex; align-items:center; justify-content:center; gap:12px; margin:16px 0; width:100%; text-align:center;">
          <div id="pagination" class="pagination"></div>
          <div class="page-size">
            <label for="pageSizeRel" style="margin-right:6px;">Itens por página:</label>
            <select id="pageSizeRel">
              <option value="10">10</option>
              <option value="20" selected>20</option>
              <option value="50">50</option>
            </select>
          </div>
        </div>
      </section>

      <footer th:replace="~{components/footer :: footer}"></footer>
    </main>
  </div>

  <div class="modal fade" id="relatorioModal" tabindex="-1" aria-labelledby="relatorioModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="relatorioModalLabel">Relatório</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div id="relatorioContent"></div>
        </div>
        <div class="modal-footer">
          <div id="relatorioExportStatus" class="me-auto"></div>
          <div class="btn-group">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">Exportar</button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#" id="btnExportPdf">Exportar PDF</a></li>
              <li><a class="dropdown-item" href="#" id="btnExportExcel">Exportar Excel</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script th:src="@{/js/script.js}"></script>
  <script>
    let chartEvolucao = null;
    let chartDepartamentos = null;
    let chartEvoController = null;
    let chartDepController = null;

    function getInputValue(id){
      var el = document.getElementById(id);
      return el ? el.value : '';
    }

    function normalizeDateParam(value, isEnd){
      if (!value) return '';
      if (/^\d{4}-\d{2}$/.test(value)){
        var parts = value.split('-');
        var y = parseInt(parts[0], 10);
        var m = parseInt(parts[1], 10);
        var last = new Date(y, m, 0).getDate();
        var day = isEnd ? last : 1;
        return parts[0] + '-' + parts[1] + '-' + (day < 10 ? ('0' + day) : day);
      }
      if (/^\d{4}-\d{2}-\d{2}$/.test(value)) return value;
      return value;
    }

    let chartsDisabled = false;

    async function updateEvolucaoChart(){
      try {
        if (!window.Chart || chartsDisabled) { return; }
        if (chartEvoController) { chartEvoController.abort(); }
        chartEvoController = new AbortController();
        const signal = chartEvoController.signal;
        const inicio = normalizeDateParam(getInputValue('periodoInicio') || '', false);
        const fim = normalizeDateParam(getInputValue('periodoFim') || '', true);
        const params = new URLSearchParams();
        if (inicio) params.set('inicio', inicio);
        if (fim) params.set('fim', fim);
        const resp = await fetch('/rh/api/relatorios/comparativo?' + params.toString(), { signal });
        if (!resp.ok) { chartsDisabled = true; showChartEmpty('emptyEvolucao', true); showChartHelp('helpEvolucao', true); return; }
        const data = await resp.json();
        const el = document.getElementById('chartEvolucaoFolha');
        if (!el) return;
        const ctx = el.getContext('2d');
        const meses = data && data.dadosPorMes ? Object.keys(data.dadosPorMes).sort() : [];
        const totais = meses.map(m => (data.dadosPorMes[m]?.totalFolha) || 0);
        if (!meses.length) { showChartEmpty('emptyEvolucao', true); showChartHelp('helpEvolucao', true); return; }
        showChartEmpty('emptyEvolucao', false);
        showChartHelp('helpEvolucao', false);
        const dataset = {
          label: 'Total da Folha',
          data: totais,
          borderColor: '#007bff',
          backgroundColor: 'rgba(0,123,255,0.1)',
          tension: 0.4
        };
        if (chartEvolucao) {
          chartEvolucao.data.labels = meses;
          chartEvolucao.data.datasets = [dataset];
          chartEvolucao.update();
        } else {
          chartEvolucao = new Chart(ctx, {
            type: 'line',
            data: { labels: meses, datasets: [dataset] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: false, ticks: { callback: function(value){ return 'R$ ' + Number(value).toLocaleString('pt-BR'); } } } } }
          });
        }
      } catch(e){ console.error('Erro ao atualizar gráfico de evolução', e); }
    }

    async function updateDepartamentoChart(){
      try {
        if (!window.Chart || chartsDisabled) { return; }
        if (chartDepController) { chartDepController.abort(); }
        chartDepController = new AbortController();
        const signal = chartDepController.signal;
        const inicio = normalizeDateParam(getInputValue('periodoInicio') || '', false);
        const fim = normalizeDateParam(getInputValue('periodoFim') || '', true);
        const dep = getInputValue('departamentoRel') || '';
        const params = new URLSearchParams();
        if (inicio) params.set('inicio', inicio);
        if (fim) params.set('fim', fim);
        if (dep) params.set('departamentoId', dep);
        const resp = await fetch('/rh/api/relatorios/gerencial?' + params.toString(), { signal });
        if (!resp.ok) { chartsDisabled = true; showChartEmpty('emptyDepartamentos', true); showChartHelp('helpDepartamentos', true); return; }
        const data = await resp.json();
        const el = document.getElementById('chartDepartamentos');
        if (!el) return;
        const ctx = el.getContext('2d');
        const itens = data && data.resumoPorDepartamento ? Object.values(data.resumoPorDepartamento) : [];
        const labels = itens.map(i => i.departamento || '');
        const valores = itens.map(i => (i.custoTotal || 0));
        if (!labels.length) { showChartEmpty('emptyDepartamentos', true); showChartHelp('helpDepartamentos', true); return; }
        showChartEmpty('emptyDepartamentos', false);
        showChartHelp('helpDepartamentos', false);
        const ds = [{ data: valores, backgroundColor: ['#007bff','#28a745','#ffc107','#dc3545','#6f42c1','#17a2b8','#6c757d','#20c997','#fd7e14','#6610f2'] }];
        if (chartDepartamentos) {
          chartDepartamentos.data.labels = labels;
          chartDepartamentos.data.datasets = ds;
          chartDepartamentos.update();
        } else {
          chartDepartamentos = new Chart(ctx, {
            type: 'doughnut',
            data: { labels, datasets: ds },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
          });
        }
      } catch(e){ console.error('Erro ao atualizar gráfico de departamentos', e); }
    }

    function updateCharts(){
      updateEvolucaoChart();
      updateDepartamentoChart();
    }

    function showChartEmpty(id, show){
      var el = document.getElementById(id);
      if (el) el.style.display = show ? 'flex' : 'none';
    }

    function showChartHelp(id, show){
      var el = document.getElementById(id);
      if (el) el.style.display = show ? 'block' : 'none';
    }

    window.addEventListener('load', function(){
      updateCharts();
      const i = document.getElementById('periodoInicio');
      const f = document.getElementById('periodoFim');
      const d = document.getElementById('departamentoRel');
      if (i) i.addEventListener('change', updateCharts);
      if (f) f.addEventListener('change', updateCharts);
      if (d) d.addEventListener('change', updateCharts);
    });

    function formatCurrencyBr(v){
      try { return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0); } catch { return 'R$ 0,00'; }
    }

    function showLoadingRel(show){
      const el = document.getElementById('holeritesLoadingRel');
      if (el) el.style.display = show ? 'block' : 'none';
    }

    let currentPage = 0;
    let folhaIdAtualRel = null;
    let queryRel = '';
    let pageSizeRel = 20;
    let debounceTimerRel;

    async function carregarHoleritesFolha(folhaId, page = 0){
      folhaIdAtualRel = folhaId;
      currentPage = page;
      const tbody = document.getElementById('tbodyHolerites');
      const prevScroll = window.scrollY;
      showLoadingRel(true);
      try {
        const depEl = document.getElementById('departamentoRel');
        const departamentoParam = (depEl && depEl.value ? depEl.value : '').trim();
        const sizeParam = pageSizeRel || 20;
        const url = '/rh/folha-pagamento/api/folha/' + folhaId + '/holerites?page=' + page + '&size=' + sizeParam + '&q=' + encodeURIComponent(queryRel) + (departamentoParam ? '&departamentoId=' + encodeURIComponent(departamentoParam) : '');
        const resp = await fetch(url);
        const data = await resp.json();
        const itens = (data && data.content) ? data.content : [];
        let rows = '';
        let totalBase = 0, totalProv = 0, totalDesc = 0, totalLiq = 0;
        for (const it of itens){
          const pctDesc = it.totalProventos > 0 ? Math.round(10000 * (it.totalDescontos / it.totalProventos)) / 100 : 0;
          rows += '<tr>' +
            '<td>' + (it.nome || '-') + '</td>' +
            '<td>' + (it.departamento || '-') + '</td>' +
            '<td>' + formatCurrencyBr(it.salarioBase) + '</td>' +
            '<td>' + formatCurrencyBr(it.totalProventos) + '</td>' +
            '<td>' + formatCurrencyBr(it.totalDescontos) + '</td>' +
            '<td>' + formatCurrencyBr(it.salarioLiquido) + '</td>' +
            '<td>' + pctDesc + '%</td>' +
            '<td class="actions">' +
              '<a href="/rh/folha-pagamento/holerite/' + it.id + '" class="btn btn-sm btn-info" title="Ver"><i class="fas fa-eye"></i></a>' +
              '<a href="/rh/folha-pagamento/holerite/' + it.id + '/pdf" class="btn btn-sm btn-primary" title="PDF"><i class="fas fa-file-pdf"></i></a>' +
            '</td>' +
          '</tr>';
        
          totalBase += (it.salarioBase || 0);
          totalProv += (it.totalProventos || 0);
          totalDesc += (it.totalDescontos || 0);
          totalLiq += (it.salarioLiquido || 0);
        }
        tbody.innerHTML = rows || '<tr><td colspan="8" class="text-center">Nenhum holerite encontrado</td></tr>';
        document.getElementById('totalSalarioBase').innerText = formatCurrencyBr(totalBase);
        document.getElementById('totalProventos').innerText = formatCurrencyBr(totalProv);
        document.getElementById('totalDescontos').innerText = formatCurrencyBr(totalDesc);
        document.getElementById('totalLiquido').innerText = formatCurrencyBr(totalLiq);
        const pct = totalProv > 0 ? Math.round(10000 * (totalDesc / totalProv)) / 100 : 0;
        document.getElementById('percentualDesconto').innerText = pct + '%';
        renderPagination(data);
        showLoadingRel(false);
        window.scrollTo(0, prevScroll);
      } catch (e){
        tbody.innerHTML = '<tr><td colspan="8" class="text-center">Erro ao carregar holerites</td></tr>';
        renderPagination({ currentPage: 0, totalPages: 1, totalElements: 0, hasPrevious: false, hasNext: false });
        showLoadingRel(false);
        window.scrollTo(0, prevScroll);
      }
    }

    function renderPagination(data){
      const el = document.getElementById('pagination');
      if (!el) return;
      const totalPages = data.totalPages || 0;
      const totalElements = data.totalElements || 0;
      const page = data.currentPage || 0;
      const hasPrev = !!data.hasPrevious;
      const hasNext = !!data.hasNext;
      let html = '';
      const lastPage = Math.max(0, totalPages - 1);
      html += '<span class="pagination-info">Página ' + (page + 1) + ' de ' + Math.max(totalPages, 1) + ' (' + totalElements + ' registros)</span>';
      html += page > 0 ? '<a class="btn btn-secondary" href="#" data-page="0"><i class="fas fa-angle-double-left"></i> Primeira</a>' : '<span class="btn btn-secondary disabled"><i class="fas fa-angle-double-left"></i> Primeira</span>';
      html += hasPrev ? '<a class="btn btn-secondary" href="#" data-page="' + (page - 1) + '"><i class="fas fa-chevron-left"></i> Anterior</a>' : '<span class="btn btn-secondary disabled"><i class="fas fa-chevron-left"></i> Anterior</span>';
      html += hasNext ? '<a class="btn btn-secondary" href="#" data-page="' + (page + 1) + '">Próxima <i class="fas fa-chevron-right"></i></a>' : '<span class="btn btn-secondary disabled">Próxima <i class="fas fa-chevron-right"></i></span>';
      html += page < lastPage ? '<a class="btn btn-secondary" href="#" data-page="' + lastPage + '">Última <i class="fas fa-angle-double-right"></i></a>' : '<span class="btn btn-secondary disabled">Última <i class="fas fa-angle-double-right"></i></span>';
      el.innerHTML = html;
      bindPaginationEvents();
    }

    function goToPage(p){
      const next = Math.max(0, p);
      if (folhaIdAtualRel) carregarHoleritesFolha(folhaIdAtualRel, next);
    }

    function bindPaginationEvents(){
      const el = document.getElementById('pagination');
      if (!el) return;
      const links = el.querySelectorAll('a[data-page]');
      links.forEach(function(a){
        a.addEventListener('click', function(e){
          e.preventDefault();
          e.stopPropagation();
          const p = parseInt(a.getAttribute('data-page'), 10);
          if (!isNaN(p)) goToPage(p);
        });
      });
    }
    (function init(){
      const sel = document.getElementById('folhaSelecionada');
      if (sel){
        sel.addEventListener('change', () => {
          const v = sel.value;
          if (v) carregarHoleritesFolha(v, 0);
        });
        if (sel.options.length > 1){
          const first = sel.options[1].value;
          sel.value = first;
          carregarHoleritesFolha(first, 0);
        }
      }
    })();

    document.addEventListener('DOMContentLoaded', function(){
      const inputRel = document.getElementById('buscarHoleriteRel');
      if (inputRel) {
        inputRel.addEventListener('input', function(e){
          clearTimeout(debounceTimerRel);
          queryRel = e.target.value || '';
          debounceTimerRel = setTimeout(function(){
            if (folhaIdAtualRel) carregarHoleritesFolha(folhaIdAtualRel, 0);
          }, 250);
        });
      }
      const selPageSize = document.getElementById('pageSizeRel');
      if (selPageSize){
        selPageSize.addEventListener('change', function(){
          const v = parseInt(selPageSize.value, 10);
          pageSizeRel = (!isNaN(v) && v > 0) ? v : 20;
          if (folhaIdAtualRel) carregarHoleritesFolha(folhaIdAtualRel, 0);
        });
      }
    });

    function gerarRelatorio(tipo, formato = 'pdf') {
      const inicio = normalizeDateParam(document.getElementById('periodoInicio').value, false);
      const fim = normalizeDateParam(document.getElementById('periodoFim').value, true);
      const departamento = document.getElementById('departamentoRel').value;
      
      if (!inicio || !fim) {
        alert('Por favor, selecione o período do relatório.');
        return;
      }
      
      const statusEl = document.getElementById('relatorioExportStatus');
      if (statusEl) statusEl.innerHTML = '<span class="text-info"><i class="fas fa-spinner fa-spin"></i> Gerando...</span>';
      
      let url;
      const params = new URLSearchParams({
        inicio: inicio,
        fim: fim
      });
      
      if (departamento) {
        params.append('departamentoId', departamento);
      }
      
      // Determinar URL baseada no tipo e formato
      if (formato === 'visualizar') {
        if (tipo === 'analitica') {
          const sel = document.getElementById('folhaSelecionada');
          const folhaId = sel && sel.value ? sel.value : null;
          if (!folhaId){
            alert('Selecione uma folha em "Folhas Recentes" para visualizar o analítico');
            if (statusEl) statusEl.innerHTML = '';
            return;
          }
          fetch('/rh/folha-pagamento/api/folha/' + folhaId + '/holerites?page=0&size=1000&q=' + encodeURIComponent(queryRel || ''))
            .then(r => r.json())
            .then(pagina => {
              const itens = Array.isArray(pagina.content) ? pagina.content : [];
              const dataAnalitica = montarDadosAnaliticaDeHolerites(itens);
              if (statusEl) statusEl.innerHTML = '';
              exibirRelatorio('analitica', dataAnalitica);
            })
            .catch(err => {
              if (statusEl) statusEl.innerHTML = '';
              console.error('Erro ao carregar holerites para analítico', err);
              alert('Erro ao carregar dados analíticos');
            });
          return;
        }
        switch(tipo) {
          case 'gerencial':
            url = '/rh/api/relatorios/gerencial?' + params;
            break;
          case 'obrigacoes':
            url = '/rh/api/relatorios/obrigacoes?' + params;
            break;
          case 'departamento':
            if (!departamento) {
              alert('Selecione um departamento para este relatório.');
              if (statusEl) statusEl.innerHTML = '';
              return;
            }
            url = '/rh/api/relatorios/departamento?' + params;
            break;
          case 'comparativo':
            url = '/rh/api/relatorios/comparativo?' + params;
            break;
          case 'beneficios':
            url = '/rh/api/relatorios/beneficios?' + params;
            break;
          default:
            alert('Tipo de relatório não suportado.');
            if (statusEl) statusEl.innerHTML = '';
            return;
          }
        
        
        
        
        
        
        // Fazer requisição AJAX para visualizar
        fetch(url)
          .then(response => response.json())
          .then(data => {
            if (statusEl) statusEl.innerHTML = '';
            exibirRelatorio(tipo, data);
          })
          .catch(error => {
            if (statusEl) statusEl.innerHTML = '';
            console.error('Erro ao gerar relatório:', error);
            alert('Erro ao gerar relatório. Verifique o console para mais detalhes.');
          });
      } else {
        // Exportação client-side
        try {
          if (formato === 'excel') {
            exportarTabelaModalCSV('relatorioContent', 'relatorio_' + tipo + '.csv');
          } else if (formato === 'pdf') {
            exportarModalParaPDF('relatorioModal', 'Relatorio - ' + tipo.toUpperCase());
          }
        } finally {
          if (statusEl) statusEl.innerHTML = '';
        }
      }
    }
    
    function exibirRelatorio(tipo, data) {
      const modalEl = document.getElementById('relatorioModal');
      if (!modalEl) return;
      const titleEl = document.getElementById('relatorioModalLabel');
      if (titleEl) {
        const inicio = getInputValue('periodoInicio');
        const fim = getInputValue('periodoFim');
        const depEl = document.getElementById('departamentoRel');
        const depTxt = depEl && depEl.options && depEl.selectedIndex >= 0 ? depEl.options[depEl.selectedIndex].text : '';
        let contexto = '';
        if (inicio && fim) contexto = contexto + ' (' + inicio + '–' + fim + ')';
        if (depTxt && depTxt.trim() && depEl.value) contexto = contexto + ' - ' + depTxt;
        titleEl.textContent = 'Relatório - ' + tipo.replace('-', ' ').toUpperCase() + contexto;
      }
      const content = document.getElementById('relatorioContent');
      formatarDadosRelatorio(tipo, data, content);
      const btnPdf = document.getElementById('btnExportPdf');
      const btnExcel = document.getElementById('btnExportExcel');
      if (btnPdf) btnPdf.onclick = function(){ gerarRelatorio(tipo, 'pdf'); };
      if (btnExcel) btnExcel.onclick = function(){ gerarRelatorio(tipo, 'excel'); };
      const bsModal = new bootstrap.Modal(modalEl);
      bsModal.show();
    }

    function montarDadosAnaliticaDeHolerites(itens){
      let totalSalarios = 0, totalDescontos = 0, totalLiquido = 0;
      const mapped = itens.map(it => {
        totalSalarios += (it.salarioBase || 0);
        totalDescontos += (it.totalDescontos || 0);
        totalLiquido += (it.salarioLiquido || 0);
        return {
          nomeColaborador: it.nome || '-',
          departamento: it.departamento || '-',
          cargo: it.cargo || '-',
          salarioBase: it.salarioBase || 0,
          inss: it.inss || 0,
          irrf: it.irrf || 0,
          totalDescontos: it.totalDescontos || 0,
          salarioLiquido: it.salarioLiquido || 0
        };
      });
      return {
        totalSalarios,
        totalDescontos,
        totalLiquido,
        itens: mapped
      };
    }

    function exportarTabelaModalCSV(containerId, filename){
      const container = document.getElementById(containerId);
      if (!container) return;
      const table = container.querySelector('table');
      if (!table) { alert('Nada para exportar'); return; }
      let csv = '';
      const rows = table.querySelectorAll('tr');
      rows.forEach(tr => {
        const cells = tr.querySelectorAll('th,td');
        const line = Array.from(cells).map(td => '"' + String(td.textContent).replace(/"/g,'""') + '"').join(',');
        csv += line + '\n';
      });
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', filename);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function exportarModalParaPDF(modalId, title){
      const modalEl = document.getElementById(modalId);
      const contentEl = document.getElementById('relatorioContent');
      if (!modalEl || !contentEl) return;
      const printWindow = window.open('', '_blank');
      const html = '' +
        '<!DOCTYPE html><html><head>' +
        '<meta charset="utf-8" />' +
        '<title>' + title + '</title>' +
        '<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />' +
        '<style> .table-list{ width:100%; } .resumo-cards{ display:flex; gap:16px; } .resumo-item{ background:#f8f9fa; padding:12px; border-radius:6px; } </style>' +
        '</head><body>' +
        '<div class="container mt-3">' +
        '<h3>' + title + '</h3>' +
        contentEl.innerHTML +
        '</div>' +
        '</body></html>';
      printWindow.document.open();
      printWindow.document.write(html);
      printWindow.document.close();
      printWindow.onload = function(){
        try {
          printWindow.focus();
          printWindow.print();
        } finally {
          setTimeout(function(){ printWindow.close(); }, 500);
        }
      };
    }
    
    function formatarDadosRelatorio(tipo, data, container) {
      let html = '';
      
      switch(tipo) {
        case 'analitica':
          html = '' +
            '<div class="resumo-cards">' +
              '<div class="resumo-item">' +
                '<h5>Total Salários</h5>' +
                '<h3 class="text-primary">R$ ' + (data.totalSalarios ? data.totalSalarios.toFixed(2) : '0,00') + '</h3>' +
              '</div>' +
              '<div class="resumo-item">' +
                '<h5>Total Descontos</h5>' +
                '<h3 class="text-danger">R$ ' + (data.totalDescontos ? data.totalDescontos.toFixed(2) : '0,00') + '</h3>' +
              '</div>' +
              '<div class="resumo-item">' +
                '<h5>Total Líquido</h5>' +
                '<h3 class="text-success">R$ ' + (data.totalLiquido ? data.totalLiquido.toFixed(2) : '0,00') + '</h3>' +
              '</div>' +
              '<div class="resumo-item">' +
                '<h5>Colaboradores</h5>' +
                '<h3 class="text-info">' + (data.itens ? data.itens.length : 0) + '</h3>' +
              '</div>' +
            '</div>' +
            '<div class="table-responsive">' +
              '<table class="table-list">' +
                '<thead>' +
                  '<tr>' +
                    '<th>Nome</th>' +
                    '<th>Departamento</th>' +
                    '<th>Cargo</th>' +
                    '<th>Salário Base</th>' +
                    '<th>INSS</th>' +
                    '<th>IRRF</th>' +
                    '<th>Total Descontos</th>' +
                    '<th>Salário Líquido</th>' +
                  '</tr>' +
                '</thead>' +
                '<tbody>' +
          '';
          if (data.itens) {
            data.itens.forEach(item => {
              html += '<tr>' +
                  '<td>' + (item.nomeColaborador || '') + '</td>' +
                  '<td>' + (item.departamento || '') + '</td>' +
                  '<td>' + (item.cargo || '') + '</td>' +
                  '<td>R$ ' + (item.salarioBase ? item.salarioBase.toFixed(2) : '0,00') + '</td>' +
                  '<td>R$ ' + (item.inss ? item.inss.toFixed(2) : '0,00') + '</td>' +
                  '<td>R$ ' + (item.irrf ? item.irrf.toFixed(2) : '0,00') + '</td>' +
                  '<td>R$ ' + (item.totalDescontos ? item.totalDescontos.toFixed(2) : '0,00') + '</td>' +
                  '<td>R$ ' + (item.salarioLiquido ? item.salarioLiquido.toFixed(2) : '0,00') + '</td>' +
                '</tr>';
            });
          }
          html += '</tbody></table></div>';
          break;

        case 'gerencial':
          html = '' +
            '<div class="resumo-cards">' +
              '<div class="resumo-item">' +
                '<h5>Total Colaboradores</h5>' +
                '<h3 class="text-primary">' + (data.totalColaboradores || 0) + '</h3>' +
              '</div>' +
              '<div class="resumo-item">' +
                '<h5>Total Folha</h5>' +
                '<h3 class="text-success">R$ ' + (data.totalFolha ? data.totalFolha.toFixed(2) : '0,00') + '</h3>' +
              '</div>' +
            '</div>' +
            '<div class="table-responsive">' +
              '<table class="table-list">' +
                '<thead>' +
                  '<tr>' +
                    '<th>Departamento</th>' +
                    '<th>Colaboradores</th>' +
                    '<th>Custo Total</th>' +
                    '<th>Média Salarial</th>' +
                  '</tr>' +
                '</thead>' +
                '<tbody>' +
          '';
          if (data.resumoPorDepartamento) {
            Object.values(data.resumoPorDepartamento).forEach(resumo => {
              html += '<tr>' +
                  '<td>' + (resumo.departamento || '') + '</td>' +
                  '<td>' + (resumo.colaboradores || 0) + '</td>' +
                  '<td>R$ ' + (resumo.custoTotal ? resumo.custoTotal.toFixed(2) : '0,00') + '</td>' +
                  '<td>R$ ' + (resumo.mediaSalarial ? resumo.mediaSalarial.toFixed(2) : '0,00') + '</td>' +
                '</tr>';
            });
          }
          html += '</tbody></table></div>';
          break;
        case 'obrigacoes':
          html = '' +
            '<div class="table-responsive">' +
              '<table class="table-list">' +
                '<thead>' +
                  '<tr>' +
                    '<th>Colaborador</th>' +
                    '<th>Departamento</th>' +
                    '<th>INSS</th>' +
                    '<th>IRRF</th>' +
                    '<th>FGTS</th>' +
                    '<th>Total Obrigações</th>' +
                  '</tr>' +
                '</thead>' +
                '<tbody>' +
          '';
          if (data.itens) {
            data.itens.forEach(item => {
              const inss = item.inss || 0;
              const irrf = item.irrf || 0;
              const fgts = item.fgts || 0;
              const total = inss + irrf + fgts;
              html += '<tr>' +
                '<td>' + (item.nomeColaborador || item.nome || '-') + '</td>' +
                '<td>' + (item.departamento || '-') + '</td>' +
                '<td>' + formatCurrencyBr(inss) + '</td>' +
                '<td>' + formatCurrencyBr(irrf) + '</td>' +
                '<td>' + formatCurrencyBr(fgts) + '</td>' +
                '<td>' + formatCurrencyBr(total) + '</td>' +
              '</tr>';
            });
          }
          html += '</tbody></table></div>';
          break;
        case 'departamento':
          html = '' +
            '<div class="table-responsive">' +
              '<table class="table-list">' +
                '<thead>' +
                  '<tr>' +
                    '<th>Departamento</th>' +
                    '<th>Colaboradores</th>' +
                    '<th>Custo Total</th>' +
                    '<th>Média Salarial</th>' +
                  '</tr>' +
                '</thead>' +
                '<tbody>' +
          '';
          if (data.resumoPorDepartamento) {
            Object.values(data.resumoPorDepartamento).forEach(resumo => {
              html += '<tr>' +
                '<td>' + (resumo.departamento || '') + '</td>' +
                '<td>' + (resumo.colaboradores || 0) + '</td>' +
                '<td>' + formatCurrencyBr(resumo.custoTotal || 0) + '</td>' +
                '<td>' + formatCurrencyBr(resumo.mediaSalarial || 0) + '</td>' +
              '</tr>';
            });
          }
          html += '</tbody></table></div>';
          break;
        case 'comparativo':
          html = '' +
            '<div class="table-responsive">' +
              '<table class="table-list">' +
                '<thead>' +
                  '<tr>' +
                    '<th>Mês</th>' +
                    '<th>Colaboradores</th>' +
                    '<th>Total da Folha</th>' +
                    '<th>Novas Contratações</th>' +
                    '<th>Desligamentos</th>' +
                  '</tr>' +
                '</thead>' +
                '<tbody>' +
          '';
          if (data.dadosPorMes) {
            Object.keys(data.dadosPorMes).forEach(mes => {
              const d = data.dadosPorMes[mes] || {};
              html += '<tr>' +
                '<td>' + mes + '</td>' +
                '<td>' + (d.colaboradores || 0) + '</td>' +
                '<td>' + formatCurrencyBr(d.totalFolha || 0) + '</td>' +
                '<td>' + (d.novasContratacoes || 0) + '</td>' +
                '<td>' + (d.desligamentos || 0) + '</td>' +
              '</tr>';
            });
          }
          html += '</tbody></table></div>';
          break;
        case 'beneficios':
          html = '' +
            '<div class="resumo-cards">' +
              '<div class="resumo-item">' +
                '<h5>Custo Total de Benefícios</h5>' +
                '<h3 class="text-primary">' + formatCurrencyBr((data.custoTotalBeneficios || 0)) + '</h3>' +
              '</div>' +
            '</div>' +
            '<div class="table-responsive">' +
              '<table class="table-list">' +
                '<thead>' +
                  '<tr>' +
                    '<th>Benefício</th>' +
                    '<th>Colaboradores</th>' +
                    '<th>Custo Total</th>' +
                  '</tr>' +
                '</thead>' +
                '<tbody>' +
          '';
          if (data.beneficiosPorTipo) {
            Object.keys(data.beneficiosPorTipo).forEach(nome => {
              const b = data.beneficiosPorTipo[nome] || {};
              html += '<tr>' +
                '<td>' + (b.nome || nome) + '</td>' +
                '<td>' + (b.colaboradores || b.quantidade || 0) + '</td>' +
                '<td>' + formatCurrencyBr(b.custoTotal || 0) + '</td>' +
              '</tr>';
            });
          }
          html += '</tbody></table></div>';
          break;
        
        default:
          html = '<div class="alert alert-warning">Formato de relatório não suportado.</div>';
      }
      
      container.innerHTML = '<div class="modal-report">' + html + '</div>';
    }

    function exportarTodosRelatorios() {
      if (confirm('Deseja exportar todos os relatórios? Esta operação pode demorar alguns minutos.')) {
        alert('Iniciando exportação de todos os relatórios...');
        // Implementar exportação em lote
      }
    }

    function verDetalhesColaborador(id) {
      alert('Visualizando detalhes do colaborador ' + id);
      // Implementar visualização de detalhes
    }

    function gerarHolerite(id) {
      alert('Gerando holerite para o colaborador ' + id);
      // Implementar geração de holerite individual
    }
  </script>
  
  <style>
    .resumo-executivo {
      margin: 20px 0;
    }
    
    .resumo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    
    .resumo-card {
      display: flex;
      align-items: center;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    
    .resumo-card:hover {
      transform: translateY(-2px);
    }
    
    .resumo-card.salarios {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .resumo-card.descontos {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }
    
    .resumo-card.liquido {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
    }
    
    .resumo-card.colaboradores {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      color: white;
    }
    
    .resumo-icon {
      font-size: 32px;
      margin-right: 20px;
      opacity: 0.9;
    }
    
    .resumo-valor {
      font-size: 24px;
      font-weight: bold;
      margin: 5px 0;
    }
    
    .resumo-variacao {
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .resumo-variacao.positiva {
      color: #d4edda;
    }
    
    .resumo-variacao.negativa {
      color: #f8d7da;
    }
    
    .resumo-variacao.neutra {
      color: #e2e3e5;
    }
    
    .charts-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    
    .chart-card {
      padding: 20px;
    }
    
    .relatorios-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .relatorio-item {
      display: flex;
      align-items: flex-start;
      padding: 20px;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      background: #f8f9fa;
      transition: box-shadow 0.2s;
    }
    
    .relatorio-item:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .relatorio-icon {
      font-size: 24px;
      color: #007bff;
      margin-right: 15px;
      margin-top: 5px;
    }
    
    .relatorio-info h4 {
      margin-bottom: 8px;
      color: #333;
    }
    
    .relatorio-info p {
      margin-bottom: 15px;
      color: #666;
      font-size: 14px;
    }
    
    .relatorio-actions {
      display: flex;
      gap: 10px;
    }
    
    .table-responsive {
      overflow-x: auto;
    }
    
    .total-row {
      background: #f8f9fa;
      font-weight: bold;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    
    .modal-dialog {
      background: white;
      border-radius: 8px;
      max-width: 90vw;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8f9fa;
    }
    
    .modal-title {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }
    
    .btn-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .btn-close:hover {
      color: #000;
    }
    
    .modal-body {
      padding: 20px;
      max-height: 60vh;
      overflow-y: auto;
    }
    #relatorioContent { width: 100%; }
    
    .modal-footer {
      padding: 20px;
      border-top: 1px solid #e9ecef;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      background: #f8f9fa;
    }
    
    .resumo-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .resumo-item {
      text-align: center;
      padding: 15px;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      background: #f8f9fa;
    }
    
    .resumo-item h5 {
      margin-bottom: 10px;
      color: #666;
      font-size: 14px;
    }
    
    .resumo-item h3 {
      margin: 0;
      font-size: 20px;
    }
    
    .text-primary { color: #007bff !important; }
    .text-success { color: #28a745 !important; }
    .text-danger { color: #dc3545 !important; }
    .text-info { color: #17a2b8 !important; }
    .table-list { width: 100%; }
    .table-list thead th { position: sticky; top: 0; background: #fff; z-index: 1; }
    .table-list tbody tr:nth-child(even) { background: #f9fafb; }
    .pagination { display:flex; align-items:center; justify-content:center; gap:8px; flex-wrap:wrap; }
    .pagination-info { margin-right: 8px; }
    .page-size { display:flex; align-items:center; gap:8px; }
    .charts-container { display:grid; grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); gap:16px; align-items:start; }
    .chart-card { min-height: 320px; }
    .chart-wrapper { position: relative; }
    .chart-empty { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(248,249,250,0.7); color:#6c757d; font-weight:600; border-radius:8px; }
    .chart-help { margin-top:6px; color:#dc3545; font-size: 0.9rem; }
    
    @media (max-width: 768px) {
      .charts-container {
        grid-template-columns: 1fr;
      }
      
      .resumo-grid {
        grid-template-columns: 1fr;
      }
      
      .relatorios-grid {
        grid-template-columns: 1fr;
      }
      
      .modal-dialog {
        max-width: 95vw;
        margin: 10px;
      }
      
      .resumo-cards {
        grid-template-columns: 1fr;
      }
    }
  </style>
  
  <script src="/js/sidebar.js" defer></script>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script th:src="@{/js/notifications.js}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>
