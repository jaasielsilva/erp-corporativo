<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Recrutamento - Pipeline</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet"><link href="/css/style.css" rel="stylesheet"><link href="/css/sidebar.css" rel="stylesheet"><link href="/css/notifications.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="app-container"><aside th:replace="~{components/sidebar :: sidebar}"></aside><main class="main-content"><header th:replace="~{components/topbar :: topbar}"></header><section class="content-area"><div class="container-fluid"><div class="row"><div class="col-12"><h1 class="h4 mb-3"><i class="fas fa-filter me-2"></i>Recrutamento - Pipeline</h1><div class="card"><div class="card-body">
<div class="row g-3 align-items-end mb-3"><div class="col-md-3"><label class="form-label">Etapa</label><select class="form-select" id="filtroEtapa"><option value="">Todas</option><option>TRIAGEM</option><option>ENTREVISTA</option><option>OFERTA</option><option>CONTRATADO</option><option>REPROVADO</option></select></div><div class="col-md-4"><label class="form-label">Vaga</label><select class="form-select" id="filtroVaga"><option value="">Todas</option></select></div><div class="col-md-2"><button class="btn btn-secondary w-100" id="btnFiltrar"><i class="fas fa-filter me-1"></i>Filtrar</button></div><div class="col-md-3"><a href="/rh/recrutamento/relatorios" class="btn btn-outline-primary w-100"><i class="fas fa-chart-line me-1"></i>Relatórios</a></div></div><div class="table-responsive"><table class="table table-striped"><thead><tr><th>ID</th><th>Candidato</th><th>Vaga</th><th>Etapa</th><th>Ações</th></tr></thead><tbody id="tbody"></tbody></table></div>
</div></div></div></div></div></section><footer th:replace="~{components/footer :: footer}"></footer></main></div>
<script src="/js/sidebar.js" defer></script><script src="https://code.jquery.com/jquery-3.7.0.min.js"></script><script th:src="@{/js/notifications.js}"></script>
<script>
let vagas = [];
function carregarVagas(){ $.get('/api/rh/recrutamento/vagas',{status:'ABERTA',page:0,size:100}).done(function(page){ vagas = (page&&page.content)||[]; const sel = document.getElementById('filtroVaga'); sel.innerHTML = '<option value="">Todas</option>' + vagas.map(v => `<option value="${v.id}">${v.titulo}</option>`).join(''); }); }
function carregar(){ const etapa = $('#filtroEtapa').val()||null; const vagaId = $('#filtroVaga').val()||null; const params = {}; if (etapa) params.etapa = etapa; if (vagaId) params.vagaId = vagaId; $.get('/api/rh/recrutamento/candidaturas', params).done(function(list){ const tbody = document.getElementById('tbody'); tbody.innerHTML = ''; (list||[]).forEach(function(c){ const tr = document.createElement('tr'); const vagaTitulo = c.vaga && c.vaga.titulo ? c.vaga.titulo : '-'; const candNome = c.candidato && c.candidato.nome ? c.candidato.nome : '-'; const etapas = ['TRIAGEM','ENTREVISTA','OFERTA','CONTRATADO','REPROVADO']; const etapaSel = `<select class="form-select form-select-sm" onchange="alterarEtapa(${c.id}, this.value)">` + etapas.map(e => `<option value="${e}" ${e===c.etapa?'selected':''}>${e}</option>`).join('') + `</select>`; const btnAgendar = `<button class="btn btn-sm btn-outline-secondary me-1" onclick="agendar(${c.id})"><i class="fas fa-calendar-alt"></i></button>`; const btnAvaliar = `<button class="btn btn-sm btn-outline-success" onclick="avaliar(${c.id})"><i class="fas fa-star"></i></button>`; tr.innerHTML = `<td>${c.id}</td><td>${candNome}</td><td>${vagaTitulo}</td><td><span class="badge bg-info">${c.etapa}</span></td><td style="min-width:220px">${etapaSel} ${btnAgendar} ${btnAvaliar}</td>`; tbody.appendChild(tr); }); }); }
function alterarEtapa(id, etapa){ $.post(`/api/rh/recrutamento/candidaturas/${id}/etapa`, {etapa}).done(function(r){ if(r&&r.success){ if(typeof showToast==='function'){ showToast({title:'Recrutamento',message:'Etapa atualizada',priority:'LOW'});} carregar(); } }).fail(function(){ if(typeof showToast==='function'){ showToast({title:'Recrutamento',message:'Falha ao atualizar etapa',priority:'HIGH'});} }); }
function agendar(id){ const inicio = prompt('Início (YYYY-MM-DDTHH:mm)'); if(!inicio) return; const fim = prompt('Fim (YYYY-MM-DDTHH:mm)'); if(!fim) return; const local = prompt('Local'); const tipo = prompt('Tipo'); $.post(`/api/rh/recrutamento/candidaturas/${id}/entrevistas`, {inicio, fim, local, tipo}).done(function(r){ if(r&&r.success){ if(typeof showToast==='function'){ showToast({title:'Recrutamento',message:'Entrevista agendada',priority:'LOW'});} } }).fail(function(){ if(typeof showToast==='function'){ showToast({title:'Recrutamento',message:'Falha ao agendar entrevista',priority:'HIGH'});} }); }
function avaliar(id){ const notaStr = prompt('Nota (0-10)'); if(notaStr==null) return; const nota = parseInt(notaStr,10); const feedback = prompt('Feedback'); $.post(`/api/rh/recrutamento/candidaturas/${id}/avaliacao`, {nota, feedback}).done(function(r){ if(r&&r.success){ if(typeof showToast==='function'){ showToast({title:'Recrutamento',message:'Avaliação registrada',priority:'LOW'});} } }).fail(function(){ if(typeof showToast==='function'){ showToast({title:'Recrutamento',message:'Falha ao avaliar',priority:'HIGH'});} }); }
$(document).ready(function(){ carregarVagas(); carregar(); $('#btnFiltrar').on('click', carregar); $('#filtroEtapa,#filtroVaga').on('change', carregar); });
</script>
</body>
</html>
