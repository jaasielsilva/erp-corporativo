<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Recrutamento - Relatórios</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet"><link href="/css/style.css" rel="stylesheet"><link href="/css/sidebar.css" rel="stylesheet"><link href="/css/notifications.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="app-container"><aside th:replace="~{components/sidebar :: sidebar}"></aside><main class="main-content"><header th:replace="~{components/topbar :: topbar}"></header><section class="content-area"><div class="container-fluid"><div class="row"><div class="col-12"><h1 class="h4 mb-3"><i class="fas fa-chart-line me-2"></i>Recrutamento - Relatórios</h1><div class="card"><div class="card-body">
<div class="row g-3 align-items-end mb-3"><div class="col-md-3"><label class="form-label">Etapa</label><select class="form-select" id="etapa"><option value="">Todas</option><option>TRIAGEM</option><option>ENTREVISTA</option><option>OFERTA</option><option>CONTRATADO</option><option>REPROVADO</option></select></div><div class="col-md-3"><button class="btn btn-outline-secondary" onclick="carregar()"><i class="fas fa-sync"></i> Atualizar</button></div><div class="col-md-3"><button class="btn btn-outline-primary" onclick="exportCsv()"><i class="fas fa-file-csv"></i> CSV</button></div><div class="col-md-3"><button class="btn btn-outline-danger" onclick="exportPdf()"><i class="fas fa-file-pdf"></i> PDF</button></div></div>
<div class="table-responsive"><table class="table table-striped"><thead><tr><th>Total</th><th>Contratados</th><th>Reprovados</th><th>Taxa Conversão</th><th>Tempo Médio (dias)</th><th>Diversidade F</th><th>Diversidade M</th></tr></thead><tbody id="tbody"></tbody></table></div><div class="mt-4"><h5 class="mb-3"><i class="fas fa-chart-pie me-2"></i>Conversão por Etapa</h5><canvas id="chartEtapas" style="width:100%;height:280px"></canvas></div>
</div></div></div></div></div></section><footer th:replace="~{components/footer :: footer}"></footer></main></div>
<script src="/js/sidebar.js" defer></script><script src="https://code.jquery.com/jquery-3.7.0.min.js"></script><script th:src="@{/js/notifications.js}"></script>
<script>
let chart;
function carregar(){ const etapa=$('#etapa').val()||null; $.get('/api/rh/recrutamento/relatorios/metrics',{etapa:etapa}).done(function(list){ const tbody=document.getElementById('tbody'); tbody.innerHTML=''; (list||[]).forEach(function(m){ const tr=document.createElement('tr'); tr.innerHTML=`<td>${m.total}</td><td>${m.contratados}</td><td>${m.reprovados}</td><td>${(m.taxaConversao*100).toFixed(0)}%</td><td>${m.tempoMedioContratacaoDias}</td><td>${m.diversidadeFeminino}</td><td>${m.diversidadeMasculino}</td>`; tbody.appendChild(tr); }); }); carregarChart(); }
function carregarChart(){ $.get('/api/rh/recrutamento/relatorios/por-etapa').done(function(list){ const labels = (list||[]).map(x=>x.etapa); const dados = (list||[]).map(x=>x.count); const ctx = document.getElementById('chartEtapas').getContext('2d'); if(chart){ chart.data.labels = labels; chart.data.datasets[0].data = dados; chart.update(); } else { chart = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [{ label: 'Candidaturas', data: dados, backgroundColor: '#0d6efd' }] }, options: { responsive: true, plugins: { legend: { display: true } }, scales: { y: { beginAtZero: true } } } }); } }); }
function exportCsv(){ const etapa=$('#etapa').val()||''; window.open('/api/rh/recrutamento/relatorios/export.csv?etapa='+etapa,'_blank'); }
function exportPdf(){ const etapa=$('#etapa').val()||''; window.open('/api/rh/recrutamento/relatorios/export.pdf?etapa='+etapa,'_blank'); }
$(document).ready(function(){ carregar(); });
</script>
</body>
</html>
