<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nova Solicita√ß√£o de Acesso - ERP Corporativo</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" th:href="@{/css/style.css}" />
  <style>
    .form-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .form-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #f9fafb;
    }

    .form-section h3 {
      color: #1f2937;
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #3b82f6;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-weight: 600;
      color: #374151;
      margin-bottom: 0.5rem;
    }

    .form-control {
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-control:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: white;
      transition: all 0.2s;
    }

    .checkbox-item:hover {
      border-color: #3b82f6;
      background: #f0f9ff;
    }

    .checkbox-item input[type="checkbox"] {
      margin-right: 0.75rem;
      transform: scale(1.2);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
      cursor: pointer;
    }

    .btn-primary {
      background: #3b82f6;
      color: white;
    }

    .btn-primary:hover {
      background: #2563eb;
    }

    .btn-secondary {
      background: #6b7280;
      color: white;
    }

    .btn-secondary:hover {
      background: #4b5563;
    }

    .alert {
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .alert-success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #a7f3d0;
    }

    .alert-danger {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fca5a5;
    }

    .action-buttons {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .required::after {
      content: " *";
      color: #ef4444;
    }

    .hidden {
      display: none;
    }

    .colaborador-info {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      border-radius: 6px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .colaborador-info h4 {
      color: #0369a1;
      margin-bottom: 0.5rem;
    }

    .colaborador-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.5rem;
      font-size: 0.9rem;
    }

    /* Garantir que o footer apare√ßa */
    .main-content {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .content-area {
      flex: 1;
    }
  </style>
</head>

<body>
  <div class="app-container">
    <aside th:replace="~{components/sidebar :: sidebar}"></aside>

    <main class="main-content">
      <header th:replace="~{components/topbar :: topbar}"></header>

      <section class="content-area">
        <h1>Nova Solicita√ß√£o de Acesso</h1>
        <h2>Preencha os dados para solicitar acesso ao sistema</h2>

        <div class="action-buttons">
          <a href="/solicitacoes" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Voltar √†s Solicita√ß√µes
          </a>
        </div>

        <!-- Mensagens de Sucesso e Erro -->
        <div th:if="${mensagem}" class="alert alert-success">
          <i class="fas fa-check-circle"></i>
          <span th:text="${mensagem}"></span>
        </div>

        <div th:if="${erro}" class="alert alert-danger">
          <i class="fas fa-exclamation-triangle"></i>
          <span th:text="${erro}"></span>
        </div>

        <form class="form-container" method="post" action="/solicitacoes/nova" th:object="${solicitacaoAcesso}">

          <!-- Informa√ß√µes do Colaborador -->
          <div class="form-section">
            <h3><i class="fas fa-user"></i> Informa√ß√µes do Colaborador</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="colaborador" class="required">Colaborador</label>
                <select id="colaborador" name="colaborador.id" class="form-control" required>
                  <option value="">Selecione o colaborador...</option>
                  <!-- Colaboradores ser√£o carregados via AJAX -->
                </select>
              </div>

              <div class="form-group">
                <label for="tipoUsuario" class="required">Tipo de Usu√°rio</label>
                <select id="tipoUsuario" name="tipoUsuario" class="form-control" required>
                  <option value="">Selecione o tipo...</option>
                  <option value="FUNCIONARIO">Funcion√°rio CLT</option>
                  <option value="TERCEIRIZADO">Terceirizado</option>
                  <option value="ESTAGIARIO">Estagi√°rio</option>
                  <option value="CONSULTOR">Consultor</option>
                  <option value="REPRESENTANTE">Representante</option>
                </select>
              </div>
            </div>

            <!-- Informa√ß√µes do colaborador selecionado -->
            <div id="colaboradorInfo" class="colaborador-info hidden">
              <h4><i class="fas fa-info-circle"></i> Dados do Colaborador</h4>
              <div class="colaborador-details">
                <div><strong>Nome:</strong> <span id="colaboradorNome"></span></div>
                <div><strong>Email:</strong> <span id="colaboradorEmail"></span></div>
                <div><strong>CPF:</strong> <span id="colaboradorCpf"></span></div>
              </div>
            </div>
          </div>

          <!-- M√≥dulos de Acesso -->
          <div class="form-section">
            <h3><i class="fas fa-th-large"></i> M√≥dulos de Acesso</h3>
            <p>Selecione os m√≥dulos que o usu√°rio deve ter acesso:</p>

            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="modulo_RH" name="modulos" value="RH">
                <label for="modulo_RH">
                  <i class="fas fa-users"></i> Recursos Humanos
                </label>
              </div>

              <div class="checkbox-item">
                <input type="checkbox" id="modulo_FINANCEIRO" name="modulos" value="FINANCEIRO">
                <label for="modulo_FINANCEIRO">
                  <i class="fas fa-dollar-sign"></i> Financeiro
                </label>
              </div>

              <div class="checkbox-item">
                <input type="checkbox" id="modulo_VENDAS" name="modulos" value="VENDAS">
                <label for="modulo_VENDAS">
                  <i class="fas fa-chart-line"></i> Vendas
                </label>
              </div>

              <div class="checkbox-item">
                <input type="checkbox" id="modulo_COMPRAS" name="modulos" value="COMPRAS">
                <label for="modulo_COMPRAS">
                  <i class="fas fa-shopping-cart"></i> Compras
                </label>
              </div>

              <div class="checkbox-item">
                <input type="checkbox" id="modulo_ESTOQUE" name="modulos" value="ESTOQUE">
                <label for="modulo_ESTOQUE">
                  <i class="fas fa-warehouse"></i> Estoque
                </label>
              </div>

              <div class="checkbox-item">
                <input type="checkbox" id="modulo_MARKETING" name="modulos" value="MARKETING">
                <label for="modulo_MARKETING">
                  <i class="fas fa-bullhorn"></i> Marketing
                </label>
              </div>

              <div class="checkbox-item">
                <input type="checkbox" id="modulo_TI" name="modulos" value="TI">
                <label for="modulo_TI">
                  <i class="fas fa-laptop-code"></i> TI
                </label>
              </div>

              <div class="checkbox-item">
                <input type="checkbox" id="modulo_JURIDICO" name="modulos" value="JURIDICO">
                <label for="modulo_JURIDICO">
                  <i class="fas fa-balance-scale"></i> Jur√≠dico
                </label>
              </div>
            </div>
          </div>

          <!-- N√≠vel de Acesso e Configura√ß√µes -->
          <div class="form-section">
            <h3><i class="fas fa-key"></i> Configura√ß√µes de Acesso</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="nivelSolicitado" class="required">N√≠vel de Acesso</label>
                <select id="nivelSolicitado" name="nivelSolicitado" class="form-control" required>
                  <option value="">Selecione o n√≠vel...</option>
                  <option value="CONSULTA">Consulta</option>
                  <option value="OPERACIONAL">Operacional</option>
                  <option value="SUPERVISAO">Supervis√£o</option>
                  <option value="COORDENACAO">Coordena√ß√£o</option>
                  <option value="GERENCIAL">Gerencial</option>
                  <option value="ADMINISTRATIVO">Administrativo</option>
                </select>
              </div>

              <div class="form-group">
                <label for="prazoAcesso">Prazo de Acesso</label>
                <select id="prazoAcesso" name="prazoAcesso" class="form-control">
                  <option value="PERMANENTE">Permanente</option>
                  <option value="TEMPORARIO">Tempor√°rio</option>
                </select>
              </div>
            </div>

            <!-- Campos para acesso tempor√°rio -->
            <div id="camposTemporarios" class="form-row hidden">
              <div class="form-group">
                <label for="dataInicio">Data de In√≠cio</label>
                <input type="date" id="dataInicio" name="dataInicio" class="form-control">
              </div>

              <div class="form-group">
                <label for="dataFim">Data de Fim</label>
                <input type="date" id="dataFim" name="dataFim" class="form-control">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="prioridade">Prioridade</label>
                <select id="prioridade" name="prioridade" class="form-control">
                  <option value="BAIXA">Baixa</option>
                  <option value="MEDIA" selected>M√©dia</option>
                  <option value="ALTA">Alta</option>
                  <option value="URGENTE">Urgente</option>
                </select>
              </div>

              <div class="form-group">
                <label for="dataLimite">Data Limite (se urgente)</label>
                <input type="date" id="dataLimite" name="dataLimite" class="form-control">
              </div>
            </div>
          </div>

          <!-- Justificativa -->
          <div class="form-section">
            <h3><i class="fas fa-comment-alt"></i> Justificativa</h3>

            <div class="form-group">
              <label for="justificativa" class="required">Justificativa Detalhada</label>
              <textarea id="justificativa" name="justificativa" class="form-control" rows="5"
                placeholder="Descreva detalhadamente a necessidade de acesso, as atividades que ser√£o realizadas e a import√¢ncia para o trabalho do colaborador. M√≠nimo de 50 caracteres."
                required minlength="50"></textarea>
              <small class="text-muted">M√≠nimo de 50 caracteres</small>
            </div>

            <div class="form-group">
              <label for="sistemasEspecificos">Sistemas Espec√≠ficos (opcional)</label>
              <textarea id="sistemasEspecificos" name="sistemasEspecificos" class="form-control" rows="3"
                placeholder="Se necess√°rio, especifique sistemas, relat√≥rios ou funcionalidades espec√≠ficas que o usu√°rio precisa acessar."></textarea>
            </div>
          </div>

          <!-- Bot√µes de A√ß√£o -->
          <div class="form-actions" style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
            <a href="/solicitacoes" class="btn btn-secondary">
              <i class="fas fa-times"></i> Cancelar
            </a>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-paper-plane"></i> Enviar Solicita√ß√£o
            </button>
          </div>
        </form>
      </section>

      <footer th:replace="~{components/footer :: footer}"></footer>
    </main>
  </div>

  <script>
    // Carregar colaboradores via AJAX
    document.addEventListener('DOMContentLoaded', function () {
      carregarColaboradores();
      configurarEventListeners();
    });

    function carregarColaboradores() {
      fetch('/solicitacoes/colaboradores')
        .then(response => response.json())
        .then(colaboradores => {
          const select = document.getElementById('colaborador');
          colaboradores.forEach(colaborador => {
            const option = document.createElement('option');
            option.value = colaborador.id;
            option.textContent = colaborador.nome;
            option.dataset.email = colaborador.email;
            option.dataset.cpf = colaborador.cpf;
            select.appendChild(option);
          });
        })
        .catch(error => {
          console.error('Erro ao carregar colaboradores:', error);
        });
    }

    function configurarEventListeners() {
      // Mostrar informa√ß√µes do colaborador selecionado
      document.getElementById('colaborador').addEventListener('change', function () {
        const selectedOption = this.options[this.selectedIndex];
        const infoDiv = document.getElementById('colaboradorInfo');

        if (selectedOption.value) {
          document.getElementById('colaboradorNome').textContent = selectedOption.textContent;
          document.getElementById('colaboradorEmail').textContent = selectedOption.dataset.email || 'N/A';
          document.getElementById('colaboradorCpf').textContent = selectedOption.dataset.cpf || 'N/A';
          infoDiv.classList.remove('hidden');
        } else {
          infoDiv.classList.add('hidden');
        }
      });

      // Mostrar/ocultar campos de acesso tempor√°rio
      document.getElementById('prazoAcesso').addEventListener('change', function () {
        const camposTemporarios = document.getElementById('camposTemporarios');
        if (this.value === 'TEMPORARIO') {
          camposTemporarios.classList.remove('hidden');
          document.getElementById('dataInicio').required = true;
          document.getElementById('dataFim').required = true;
        } else {
          camposTemporarios.classList.add('hidden');
          document.getElementById('dataInicio').required = false;
          document.getElementById('dataFim').required = false;
        }
      });

      // Valida√ß√£o de datas
      document.getElementById('dataInicio').addEventListener('change', function () {
        const dataFim = document.getElementById('dataFim');
        if (this.value) {
          dataFim.min = this.value;
        }
      });

      // Contador de caracteres para justificativa
      document.getElementById('justificativa').addEventListener('input', function () {
        const minLength = 50;
        const currentLength = this.value.length;
        const small = this.nextElementSibling;

        if (currentLength < minLength) {
          small.textContent = `M√≠nimo de 50 caracteres (${currentLength}/${minLength})`;
          small.style.color = '#ef4444';
        } else {
          small.textContent = `${currentLength} caracteres`;
          small.style.color = '#10b981';
        }
      });

      // Valida√ß√£o do formul√°rio antes do envio
      document.querySelector('form').addEventListener('submit', function (e) {
        const colaborador = document.getElementById('colaborador').value;
        const modulos = document.querySelectorAll('input[name="modulos"]:checked');
        const justificativa = document.getElementById('justificativa').value;

        if (!colaborador) {
          alert('Por favor, selecione um colaborador.');
          e.preventDefault();
          return;
        }

        if (modulos.length === 0) {
          alert('Por favor, selecione pelo menos um m√≥dulo de acesso.');
          e.preventDefault();
          return;
        }

        if (justificativa.length < 50) {
          alert('A justificativa deve ter pelo menos 50 caracteres.');
          e.preventDefault();
          return;
        }

        // Valida√ß√£o para acesso tempor√°rio
        const prazoAcesso = document.getElementById('prazoAcesso').value;
        if (prazoAcesso === 'TEMPORARIO') {
          const dataInicio = document.getElementById('dataInicio').value;
          const dataFim = document.getElementById('dataFim').value;

          if (!dataInicio || !dataFim) {
            alert('Para acesso tempor√°rio, as datas de in√≠cio e fim s√£o obrigat√≥rias.');
            e.preventDefault();
            return;
          }

          if (new Date(dataInicio) >= new Date(dataFim)) {
            alert('A data de fim deve ser posterior √† data de in√≠cio.');
            e.preventDefault();
            return;
          }
        }
      });
    }
  </script>
  <!-- Script de notificaÁıes -->  <!-- jQuery necess·rio para o sistema de notificaÁıes -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>



  <script th:src="@{/js/notifications.js}"></script>
  <!-- jQuery necess·rio para o sistema de notificaÁıes -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  
  <!-- Script de notificaÁıes -->  <!-- jQuery necess·rio para o sistema de notificaÁıes -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>



  <script th:src="@{/js/notifications.js}"></script>

</body>

</html>
