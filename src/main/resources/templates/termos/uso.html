<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle} ?: 'Termos de Uso - ERP Corporativo'">Termos de Uso - ERP Corporativo</title>
    
    <!-- CSS padrão -->
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/sidebar.css" rel="stylesheet">
    <link href="/css/notifications.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- CSRF para requisições AJAX -->
    <meta th:if="${_csrf != null}" name="_csrf" th:content="${_csrf.token}" />
    <meta th:if="${_csrf != null}" name="_csrf_header" th:content="${_csrf.headerName}" />

    <style>
        .content-area {
            padding: 20px;
            background-color: #f8f9fa;
            min-height: calc(100vh - 120px);
        }
        
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .terms-document {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            line-height: 1.8;
        }
        
        .terms-nav {
            position: sticky;
            top: 20px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .terms-nav .nav-link {
            color: #667eea;
            padding: 8px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .terms-nav .nav-link:hover,
        .terms-nav .nav-link.active {
            background-color: #667eea;
            color: white;
        }
        
        .section-title {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
            margin-top: 40px;
        }
        
        .section-title:first-child {
            margin-top: 0;
        }
        
        .acceptance-section {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border: 2px solid #28a745;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }
        
        .version-info {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 30px;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .btn-accept {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        .btn-accept:hover {
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside th:replace="~{components/sidebar :: sidebar}"></aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Topbar -->
            <header th:replace="~{components/topbar :: topbar}"></header>

            <!-- Content Area -->
            <section class="content-area">
                <div class="container-fluid">
                    
                    <!-- Page Header -->
                    <div class="page-header text-center">
                        <div class="container">
                            <h1>
                                <i class="fas fa-file-contract me-3"></i>
                                <span th:text="${pageTitle} ?: 'Termos de Uso'">Termos de Uso</span>
                            </h1>
                            <p class="mb-0" th:text="${pageSubtitle} ?: 'Documento completo dos termos de uso do Sistema ERP Corporativo'">Documento completo dos termos de uso do Sistema ERP Corporativo</p>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Navigation Sidebar -->
                        <div class="col-lg-3">
                            <div class="terms-nav">
                                <h6 class="fw-bold mb-3"><i class="fas fa-list me-2"></i>Navegação</h6>
                                <nav class="nav flex-column">
                                    <a class="nav-link active" href="#aceitacao">1. Aceitação dos Termos</a>
                                    <a class="nav-link" href="#definicoes">2. Definições</a>
                                    <a class="nav-link" href="#servicos">3. Descrição dos Serviços</a>
                                    <a class="nav-link" href="#responsabilidades">4. Responsabilidades</a>
                                    <a class="nav-link" href="#propriedade">5. Propriedade Intelectual</a>
                                    <a class="nav-link" href="#privacidade">6. Privacidade</a>
                                    <a class="nav-link" href="#limitacoes">7. Limitações</a>
                                    <a class="nav-link" href="#modificacoes">8. Modificações</a>
                                    <a class="nav-link" href="#rescisao">9. Rescisão</a>
                                    <a class="nav-link" href="#disposicoes">10. Disposições Gerais</a>
                                    <a class="nav-link" href="#contato">11. Contato</a>
                                </nav>
                            </div>
                        </div>

                        <!-- Main Document -->
                        <div class="col-lg-9">
                            <div class="terms-document">
                                
                                <!-- Version Info -->
                                <div class="version-info" th:if="${termo != null}">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <h6 class="mb-1">
                                                <strong>Versão <span th:text="${termo.versao}">-</span></strong>
                                            </h6>
                                            <small class="text-muted">
                                                Última atualização:
                                                <span th:text="${termo.dataPublicacao != null ? #temporals.format(termo.dataPublicacao, 'dd/MM/yyyy HH:mm') : (#temporals.format(termo.dataCriacao, 'dd/MM/yyyy HH:mm'))}">-</span>
                                            </small>
                                        </div>
                                        <div class="col-md-4 text-end">
                                            <span class="badge" th:classappend="${termo.vigente} ? ' bg-success' : ' bg-secondary'" th:text="${termo.vigente} ? 'Vigente' : 'Não vigente'">Vigente</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Acceptance Notice -->
                                <div class="acceptance-section" th:if="${termo != null}">
                                    <h5><i class="fas fa-exclamation-triangle text-warning me-2"></i>Aviso Importante</h5>
                                    <p class="mb-3">Ao utilizar o Sistema ERP Corporativo, você declara ter lido, compreendido e concordado com todos os termos e condições descritos neste documento.</p>
                                    <div th:if="${jaAceitou} == true" class="alert alert-success mb-3">
                                        <i class="fas fa-check-circle me-2"></i>
                                        Você já aceitou esta versão dos termos.
                                    </div>
                                    <button id="btnAceitar" class="btn btn-accept action-btn" th:disabled="${jaAceitou} == true" th:data-termo-id="${termo.id}" onclick="acceptTerms()">
                                        <i class="fas fa-check me-2"></i>
                                        <span th:text="${jaAceitou} == true ? 'Já Aceito' : 'Aceitar Termos'">Aceitar Termos</span>
                                    </button>
                                </div>

                                <!-- Terms Content -->
                                <h2 id="aceitacao" class="section-title">1. Aceitação dos Termos</h2>
                                <p>Ao acessar e usar o Sistema ERP Corporativo ("Sistema"), operado pela nossa empresa, você concorda em cumprir e estar vinculado aos seguintes termos e condições de uso ("Termos"). Se você não concordar com qualquer parte destes termos, não deverá usar nosso Sistema.</p>
                                <p>Estes Termos se aplicam a todos os visitantes, usuários e outras pessoas que acessam ou usam o Sistema.</p>

                                <h2 id="definicoes" class="section-title">2. Definições</h2>
                                <p>Para os fins destes Termos, as seguintes definições se aplicam:</p>
                                <ul>
                                    <li><strong>"Sistema"</strong> refere-se ao Sistema ERP Corporativo e todos os seus módulos e funcionalidades.</li>
                                    <li><strong>"Usuário"</strong> refere-se a qualquer pessoa que acesse ou use o Sistema.</li>
                                    <li><strong>"Empresa"</strong> refere-se à organização proprietária e operadora do Sistema.</li>
                                    <li><strong>"Dados"</strong> refere-se a todas as informações inseridas, processadas ou armazenadas no Sistema.</li>
                                    <li><strong>"Conta"</strong> refere-se ao perfil de usuário criado para acessar o Sistema.</li>
                                </ul>

                                <h2 id="servicos" class="section-title">3. Descrição dos Serviços</h2>
                                <p>O Sistema ERP Corporativo é uma plataforma integrada de gestão empresarial que oferece as seguintes funcionalidades principais:</p>
                                
                                <h5>3.1 Gestão de Recursos Humanos</h5>
                                <ul>
                                    <li>Cadastro e gestão de colaboradores</li>
                                    <li>Controle de ponto e escalas</li>
                                    <li>Folha de pagamento</li>
                                    <li>Gestão de benefícios</li>
                                </ul>

                                <h5>3.2 Controle Financeiro</h5>
                                <ul>
                                    <li>Contas a pagar e receber</li>
                                    <li>Fluxo de caixa</li>
                                    <li>Relatórios financeiros</li>
                                    <li>Conciliação bancária</li>
                                </ul>

                                <h5>3.3 Gestão de Projetos</h5>
                                <ul>
                                    <li>Criação e acompanhamento de projetos</li>
                                    <li>Gestão de tarefas e cronogramas</li>
                                    <li>Controle de equipes</li>
                                    <li>Relatórios de desempenho</li>
                                </ul>

                                <h2 id="responsabilidades" class="section-title">4. Responsabilidades do Usuário</h2>
                                <p>Ao usar o Sistema, o usuário se compromete a:</p>
                                <ul>
                                    <li>Manter a confidencialidade de suas credenciais de acesso</li>
                                    <li>Usar o Sistema de forma ética e em conformidade com a legislação aplicável</li>
                                    <li>Não compartilhar informações confidenciais com terceiros não autorizados</li>
                                    <li>Reportar imediatamente qualquer problema de segurança ou uso indevido</li>
                                    <li>Manter seus dados de contato atualizados</li>
                                    <li>Não tentar acessar áreas restritas do Sistema</li>
                                    <li>Não interferir no funcionamento normal do Sistema</li>
                                </ul>

                                <h2 id="propriedade" class="section-title">5. Propriedade Intelectual</h2>
                                <p>O Sistema e todo o seu conteúdo, incluindo mas não limitado a textos, gráficos, logotipos, ícones, imagens, clipes de áudio, downloads digitais, compilações de dados e software, são propriedade da Empresa ou de seus fornecedores de conteúdo e são protegidos pelas leis de direitos autorais.</p>
                                <p>É concedida ao usuário uma licença limitada, não exclusiva e não transferível para acessar e usar o Sistema para fins comerciais internos da organização.</p>

                                <h2 id="privacidade" class="section-title">6. Privacidade e Proteção de Dados</h2>
                                <p>A privacidade dos usuários é fundamental para nós. Nossa Política de Privacidade descreve como coletamos, usamos e protegemos suas informações pessoais.</p>
                                <p>Ao usar o Sistema, você concorda com a coleta e uso de informações de acordo com nossa Política de Privacidade, que está incorporada a estes Termos por referência.</p>
                                <p>Implementamos medidas de segurança técnicas e organizacionais apropriadas para proteger seus dados pessoais contra acesso não autorizado, alteração, divulgação ou destruição.</p>

                                <h2 id="limitacoes" class="section-title">7. Limitações de Responsabilidade</h2>
                                <p>Em nenhuma circunstância a Empresa será responsável por danos indiretos, incidentais, especiais, consequenciais ou punitivos, incluindo, sem limitação, perda de lucros, dados, uso, boa vontade ou outras perdas intangíveis.</p>
                                <p>O Sistema é fornecido "como está" e "conforme disponível", sem garantias de qualquer tipo, expressas ou implícitas.</p>

                                <h2 id="modificacoes" class="section-title">8. Modificações dos Termos</h2>
                                <p>Reservamo-nos o direito de modificar ou substituir estes Termos a qualquer momento, a nosso exclusivo critério. Se uma revisão for material, tentaremos fornecer pelo menos 30 dias de aviso antes de quaisquer novos termos entrarem em vigor.</p>
                                <p>O uso continuado do Sistema após a publicação de quaisquer alterações constitui aceitação dessas alterações.</p>

                                <h2 id="rescisao" class="section-title">9. Rescisão</h2>
                                <p>Podemos encerrar ou suspender sua conta imediatamente, sem aviso prévio ou responsabilidade, por qualquer motivo, incluindo, sem limitação, se você violar os Termos.</p>
                                <p>Após a rescisão, seu direito de usar o Sistema cessará imediatamente.</p>

                                <h2 id="disposicoes" class="section-title">10. Disposições Gerais</h2>
                                <p>Estes Termos constituem o acordo completo entre você e a Empresa em relação ao uso do Sistema.</p>
                                <p>Se qualquer disposição destes Termos for considerada inválida ou inexequível, as disposições restantes permanecerão em pleno vigor e efeito.</p>
                                <p>Estes Termos são regidos pelas leis do Brasil, sem consideração aos princípios de conflito de leis.</p>

                                <h2 id="contato" class="section-title">11. Informações de Contato</h2>
                                <p>Se você tiver dúvidas sobre estes Termos, entre em contato conosco:</p>
                                <ul>
                                    <li><strong>Email:</strong> juridico@empresa.com.br</li>
                                    <li><strong>Telefone:</strong> (11) 1234-5678</li>
                                    <li><strong>Endereço:</strong> Rua Exemplo, 123 - São Paulo, SP</li>
                                </ul>

                                <!-- Action Buttons -->
                                <div class="text-center mt-5">
                                    <a href="/termos" class="action-btn">
                                        <i class="fas fa-arrow-left me-2"></i>Voltar
                                    </a>
                                    <button class="btn btn-accept action-btn" th:disabled="${jaAceitou} == true" th:data-termo-id="${termo != null ? termo.id : 0}" onclick="acceptTerms()">
                                        <i class="fas fa-check me-2"></i>
                                        <span th:text="${jaAceitou} == true ? 'Já Aceito' : 'Aceitar Termos'">Aceitar Termos</span>
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </section>

            <!-- Footer -->
            <footer th:replace="~{components/footer :: footer}"></footer>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="/js/sidebar.js" defer></script>
    <script th:src="@{/js/notifications.js}"></script>
    
    <script th:inline="javascript">
        // Smooth scrolling for navigation links
        document.querySelectorAll('.terms-nav .nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                    
                    // Update active link
                    document.querySelectorAll('.terms-nav .nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });
        
        // Accept terms function
        function acceptTerms() {
            const btn = document.getElementById('btnAceitar') || document.querySelector('[onclick="acceptTerms()"]');
            const termoIdAttr = btn ? btn.getAttribute('data-termo-id') : null;
            const termoId = termoIdAttr ? parseInt(termoIdAttr, 10) : /*[[${termo != null ? termo.id : 0}]]*/ 0;
            if (!termoId) {
                alert('Termo não disponível para aceite.');
                return;
            }

            if (!confirm('Você confirma que leu e aceita todos os termos de uso?')) {
                return;
            }

            // CSRF
            const csrfToken = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]')?.getAttribute('content') || 'X-CSRF-TOKEN';

            btn.disabled = true;
            btn.classList.add('disabled');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Aceitando...';

            fetch(`/termos/aceitar/${termoId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    [csrfHeader]: csrfToken || ''
                },
                body: '{}'
            })
            .then(async (res) => {
                const text = await res.text();
                if (res.ok) {
                    alert(text || 'Termo aceito com sucesso!');
                    window.location.href = '/termos';
                } else {
                    throw new Error(text || 'Falha ao aceitar o termo.');
                }
            })
            .catch(err => {
                alert(err.message);
            })
            .finally(() => {
                btn.disabled = false;
                btn.classList.remove('disabled');
                btn.innerHTML = '<i class="fas fa-check me-2"></i>Aceitar Termos';
            });
        }
    </script>
</body>

</html>