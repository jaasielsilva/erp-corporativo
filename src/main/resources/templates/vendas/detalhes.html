<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalhes da Venda - Painel do CEO</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
  <link href="/css/sidebar.css" rel="stylesheet">
  <link href="/css/notifications.css" rel="stylesheet">
</head>

<body>
  <div class="app-container">
    <aside th:replace="~{components/sidebar :: sidebar}"></aside>

    <main class="main-content">
      <header th:replace="~{components/topbar :: topbar}"></header>

      <section class="content-area">
        <div class="container-fluid">
          <!-- Header da Página -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h1 class="display-6 fw-bold text-dark mb-0">
                    <i class="fas fa-receipt me-2"></i>Detalhes da Venda
                  </h1>
                  <p class="text-muted mb-0" th:text="'Venda #' + ${venda.numeroVenda}">Venda #000001</p>
                </div>
                <div>
                  <a th:href="@{/vendas}" class="btn btn-outline-secondary me-2">
                    <i class="fas fa-arrow-left"></i> Voltar
                  </a>
                  <a th:href="@{'/vendas/' + ${venda.id} + '/pdf'}" class="btn btn-primary" target="_blank">
                    <i class="fas fa-file-pdf"></i> Gerar PDF
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Informações Principais -->
          <div class="row mb-4">
            <div class="col-lg-8">
              <div class="card">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Informações da Venda</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <p><strong>Número da Venda:</strong> <span th:text="${venda.numeroVenda}">000001</span></p>
                      <p><strong>Data da Venda:</strong> <span th:text="${#temporals.format(venda.dataVenda, 'dd/MM/yyyy HH:mm:ss')}">01/01/2024 10:00:00</span></p>
                      <p><strong>Status:</strong> 
                        <span class="badge" th:classappend="${venda.status == 'Finalizada'} ? 'bg-success' : (${venda.status == 'Pendente'} ? 'bg-warning' : 'bg-danger')" 
                              th:text="${venda.status}">Finalizada</span>
                      </p>
                      <p><strong>Forma de Pagamento:</strong> <span th:text="${venda.formaPagamento}">Dinheiro</span></p>
                      <p th:if="${venda.parcelas != null and venda.parcelas > 1}"><strong>Parcelas:</strong> <span th:text="${venda.parcelas}">1</span>x</p>
                    </div>
                    <div class="col-md-6">
                      <p><strong>Subtotal:</strong> <span th:text="'R$ ' + ${#numbers.formatDecimal(venda.subtotal, 1, 2)}">R$ 0,00</span></p>
                      <p><strong>Desconto:</strong> <span th:text="'R$ ' + ${#numbers.formatDecimal(venda.desconto, 1, 2)}">R$ 0,00</span></p>
                      <p><strong>Total:</strong> <span class="fw-bold text-success" th:text="'R$ ' + ${#numbers.formatDecimal(venda.total, 1, 2)}">R$ 0,00</span></p>
                      <p th:if="${venda.valorPago != null}"><strong>Valor Pago:</strong> <span th:text="'R$ ' + ${#numbers.formatDecimal(venda.valorPago, 1, 2)}">R$ 0,00</span></p>
                      <p th:if="${venda.troco != null and venda.troco > 0}"><strong>Troco:</strong> <span th:text="'R$ ' + ${#numbers.formatDecimal(venda.troco, 1, 2)}">R$ 0,00</span></p>
                    </div>
                  </div>
                  <div th:if="${venda.observacoes != null and !venda.observacoes.isEmpty()}" class="mt-3">
                    <p><strong>Observações:</strong></p>
                    <p class="text-muted" th:text="${venda.observacoes}">Observações da venda</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-lg-4">
              <div class="card">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0"><i class="fas fa-user me-2"></i>Cliente</h5>
                </div>
                <div class="card-body">
                  <p><strong>Nome:</strong> <span th:text="${venda.cliente.nome}">Cliente</span></p>
                  <p><strong>CPF/CNPJ:</strong> <span th:text="${venda.cliente.cpfCnpj}">000.000.000-00</span></p>
                  <p th:if="${venda.cliente.email != null}"><strong>Email:</strong> <span th:text="${venda.cliente.email}">email@exemplo.com</span></p>
                  <p th:if="${venda.cliente.telefone != null}"><strong>Telefone:</strong> <span th:text="${venda.cliente.telefone}">(11) 99999-9999</span></p>
                  <div class="mt-3">
                    <a th:href="@{'/vendas/historico-cliente/' + ${venda.cliente.id}}" class="btn btn-outline-info btn-sm">
                      <i class="fas fa-history"></i> Ver Histórico
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Itens da Venda -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-header bg-success text-white">
                  <h5 class="mb-0"><i class="fas fa-shopping-cart me-2"></i>Itens da Venda</h5>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-striped table-hover">
                      <thead class="table-dark">
                        <tr>
                          <th>Produto</th>
                          <th>Código</th>
                          <th class="text-center">Quantidade</th>
                          <th class="text-end">Preço Unitário</th>
                          <th class="text-end">Subtotal</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr th:each="item : ${venda.itens}">
                          <td>
                            <strong th:text="${item.produto.nome}">Nome do Produto</strong>
                            <br>
                            <small class="text-muted" th:text="${item.produto.descricao}">Descrição do produto</small>
                          </td>
                          <td>
                            <span th:text="${item.produto.codigoInterno}">COD001</span>
                            <br>
                            <small class="text-muted" th:if="${item.produto.ean != null}" th:text="'EAN: ' + ${item.produto.ean}">EAN: 1234567890123</small>
                          </td>
                          <td class="text-center">
                            <span class="badge bg-primary" th:text="${item.quantidade}">1</span>
                          </td>
                          <td class="text-end" th:text="'R$ ' + ${#numbers.formatDecimal(item.precoUnitario, 1, 2)}">R$ 0,00</td>
                          <td class="text-end fw-bold" th:text="'R$ ' + ${#numbers.formatDecimal(item.subtotal, 1, 2)}">R$ 0,00</td>
                        </tr>
                      </tbody>
                      <tfoot class="table-light">
                        <tr>
                          <th colspan="4" class="text-end">Total Geral:</th>
                          <th class="text-end text-success" th:text="'R$ ' + ${#numbers.formatDecimal(venda.total, 1, 2)}">R$ 0,00</th>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Ações -->
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-header bg-warning text-dark">
                  <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Ações</h5>
                </div>
                <div class="card-body">
                  <div class="d-flex flex-wrap gap-2">
                    <a th:href="@{'/vendas/' + ${venda.id} + '/editar'}" class="btn btn-warning">
                      <i class="fas fa-edit"></i> Editar Venda
                    </a>
                    <a th:href="@{'/vendas/' + ${venda.id} + '/devolucao'}" class="btn btn-danger">
                      <i class="fas fa-undo"></i> Processar Devolução
                    </a>
                    <a th:href="@{'/vendas/' + ${venda.id} + '/cupom-fiscal'}" class="btn btn-info">
                      <i class="fas fa-print"></i> Imprimir Cupom
                    </a>
                    <button class="btn btn-secondary" onclick="window.print()">
                      <i class="fas fa-print"></i> Imprimir Página
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <footer th:replace="~{components/footer :: footer}"></footer>
    </main>
  </div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script th:src="@{/js/notifications.js}" defer></script>
  <script src="/js/sidebar.js" defer></script>
</body>

</html>