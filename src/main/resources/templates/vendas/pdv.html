<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${titulo}">PDV - ERP Empresarial</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/sidebar.css" rel="stylesheet">
    <link href="/css/notifications.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .product-grid {
            max-height: 400px;
            overflow-y: auto;
        }
        .cart-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside th:replace="~{components/sidebar :: sidebar}"></aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Topbar -->
            <header th:replace="~{components/topbar :: topbar}"></header>

            <!-- Conteúdo da página -->
            <section class="content-area">
                <div class="container-fluid">
                    <div class="row mb-4">
                        <div class="col-12">
                            <h1 class="display-6 text-muted"><i class="fas fa-cash-register"></i> PDV (Ponto de Venda)</h1>
                        </div>
                    </div>
                    
                    <div class="row">
                        <!-- Coluna da Esquerda - Busca e Produtos -->
                        <div class="col-md-8">
                            <!-- Busca de Produtos -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-barcode"></i></span>
                                                <input type="text" class="form-control" placeholder="Código de barras ou nome do produto" id="buscaProduto">
                                                <button class="btn btn-primary" type="button">
                                                    <i class="fas fa-search"></i> Buscar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Grade de Produtos -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5><i class="fas fa-boxes"></i> Produtos</h5>
                                        </div>
                                        <div class="card-body product-grid">
                                            <div class="row">
                                                <div class="col-md-4 mb-3">
                                                    <div class="card h-100 product-item" data-id="1" data-name="Produto Exemplo 1" data-price="100.00">
                                                        <div class="card-body text-center">
                                                            <h6 class="card-title">Produto Exemplo 1</h6>
                                                            <p class="card-text">R$ 100,00</p>
                                                            <button class="btn btn-primary btn-sm add-to-cart">
                                                                <i class="fas fa-plus"></i> Adicionar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <div class="card h-100 product-item" data-id="2" data-name="Produto Exemplo 2" data-price="250.00">
                                                        <div class="card-body text-center">
                                                            <h6 class="card-title">Produto Exemplo 2</h6>
                                                            <p class="card-text">R$ 250,00</p>
                                                            <button class="btn btn-primary btn-sm add-to-cart">
                                                                <i class="fas fa-plus"></i> Adicionar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <div class="card h-100 product-item" data-id="3" data-name="Produto Exemplo 3" data-price="500.00">
                                                        <div class="card-body text-center">
                                                            <h6 class="card-title">Produto Exemplo 3</h6>
                                                            <p class="card-text">R$ 500,00</p>
                                                            <button class="btn btn-primary btn-sm add-to-cart">
                                                                <i class="fas fa-plus"></i> Adicionar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <div class="card h-100 product-item" data-id="4" data-name="Produto Exemplo 4" data-price="75.00">
                                                        <div class="card-body text-center">
                                                            <h6 class="card-title">Produto Exemplo 4</h6>
                                                            <p class="card-text">R$ 75,00</p>
                                                            <button class="btn btn-primary btn-sm add-to-cart">
                                                                <i class="fas fa-plus"></i> Adicionar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <div class="card h-100 product-item" data-id="5" data-name="Produto Exemplo 5" data-price="120.00">
                                                        <div class="card-body text-center">
                                                            <h6 class="card-title">Produto Exemplo 5</h6>
                                                            <p class="card-text">R$ 120,00</p>
                                                            <button class="btn btn-primary btn-sm add-to-cart">
                                                                <i class="fas fa-plus"></i> Adicionar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <div class="card h-100 product-item" data-id="6" data-name="Produto Exemplo 6" data-price="300.00">
                                                        <div class="card-body text-center">
                                                            <h6 class="card-title">Produto Exemplo 6</h6>
                                                            <p class="card-text">R$ 300,00</p>
                                                            <button class="btn btn-primary btn-sm add-to-cart">
                                                                <i class="fas fa-plus"></i> Adicionar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Coluna da Direita - Carrinho e Finalização -->
                        <div class="col-md-4">
                            <!-- Carrinho de Compras -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5><i class="fas fa-shopping-cart"></i> Carrinho (0 itens)</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="cart-items">
                                                <!-- Itens do carrinho serão adicionados aqui -->
                                                <div class="text-center text-muted py-5">
                                                    <i class="fas fa-shopping-cart fa-2x mb-3"></i>
                                                    <p>Nenhum item no carrinho</p>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <div class="d-flex justify-content-between">
                                                    <strong>Total:</strong>
                                                    <strong id="cart-total">R$ 0,00</strong>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Finalização -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="mb-3">
                                                <label for="cliente" class="form-label">Cliente</label>
                                                <select class="form-select" id="cliente">
                                                    <option value="">Cliente não identificado</option>
                                                    <option value="1">Cliente Exemplo 1</option>
                                                    <option value="2">Cliente Exemplo 2</option>
                                                </select>
                                            </div>
                                            
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-success btn-lg" id="finalizarVenda" disabled>
                                                    <i class="fas fa-check-circle"></i> Finalizar Venda (R$ 0,00)
                                                </button>
                                                <button class="btn btn-secondary" id="limparCarrinho">
                                                    <i class="fas fa-trash"></i> Limpar Carrinho
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer th:replace="~{components/footer :: footer}"></footer>
        </main>
    </div>

    <script src="/js/sidebar.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script th:src="@{/js/notifications.js}"></script>
    <script>
        // Script básico para funcionalidade do PDV
        $(document).ready(function() {
            let cart = [];
            
            // Adicionar produto ao carrinho
            $('.add-to-cart').click(function() {
                const product = $(this).closest('.product-item');
                const id = product.data('id');
                const name = product.data('name');
                const price = parseFloat(product.data('price'));
                
                // Verificar se o produto já está no carrinho
                const existingItem = cart.find(item => item.id === id);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({
                        id: id,
                        name: name,
                        price: price,
                        quantity: 1
                    });
                }
                
                updateCart();
            });
            
            // Função para atualizar o carrinho
            function updateCart() {
                const cartItems = $('#cart-items');
                const cartTotal = $('#cart-total');
                const finalizarVenda = $('#finalizarVenda');
                const finalizarVendaText = $('#finalizarVenda span');
                
                // Limpar carrinho
                cartItems.empty();
                
                if (cart.length === 0) {
                    cartItems.append(`
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-shopping-cart fa-2x mb-3"></i>
                            <p>Nenhum item no carrinho</p>
                        </div>
                    `);
                    $('.card-header h5').text('Carrinho (0 itens)');
                    cartTotal.text('R$ 0,00');
                    finalizarVenda.prop('disabled', true);
                    finalizarVenda.html('<i class="fas fa-check-circle"></i> Finalizar Venda (R$ 0,00)');
                    return;
                }
                
                // Atualizar título do carrinho
                $('.card-header h5').text(`Carrinho (${cart.length} itens)`);
                
                // Adicionar itens ao carrinho
                let total = 0;
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    cartItems.append(`
                        <div class="cart-item">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>${item.name}</strong>
                                    <div class="small">R$ ${item.price.toFixed(2)} x ${item.quantity}</div>
                                </div>
                                <div class="text-end">
                                    <div>R$ ${itemTotal.toFixed(2)}</div>
                                    <div>
                                        <button class="btn btn-sm btn-outline-danger remove-item" data-id="${item.id}">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `);
                });
                
                // Atualizar total
                cartTotal.text('R$ ' + total.toFixed(2));
                finalizarVenda.prop('disabled', false);
                finalizarVenda.html(`<i class="fas fa-check-circle"></i> Finalizar Venda (R$ ${total.toFixed(2)})`);
                
                // Adicionar evento para remover itens
                $('.remove-item').click(function() {
                    const id = $(this).data('id');
                    cart = cart.filter(item => item.id !== id);
                    updateCart();
                });
            }
            
            // Limpar carrinho
            $('#limparCarrinho').click(function() {
                cart = [];
                updateCart();
            });
            
            // Finalizar venda
            $('#finalizarVenda').click(function() {
                if (cart.length > 0) {
                    alert('Venda finalizada com sucesso!');
                    cart = [];
                    updateCart();
                }
            });
        });
    </script>
</body>
</html>